<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Parallel Looping &amp; Variants</title>
    <meta charset="utf-8" />
    <meta name="author" content="Daniel Anderson" />
    <script src="libs/header-attrs-2.13/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/countdown-0.3.5/countdown.css" rel="stylesheet" />
    <script src="libs/countdown-0.3.5/countdown.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="new.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Parallel Looping &amp; Variants
### Daniel Anderson
### Week 5

---




layout: true

  &lt;script&gt;
    feather.replace()
  &lt;/script&gt;

  &lt;div class="slides-footer"&gt;
  &lt;span&gt;

  &lt;a class = "footer-icon-link" href = "https://github.com/uo-datasci-specialization/c3-fp-2022/raw/main/static/slides/w5.pdf"&gt;
    &lt;i class = "footer-icon" data-feather="download"&gt;&lt;/i&gt;
  &lt;/a&gt;

  &lt;a class = "footer-icon-link" href = "https://fp-2022.netlify.app/slides/w5.html"&gt;
    &lt;i class = "footer-icon" data-feather="link"&gt;&lt;/i&gt;
  &lt;/a&gt;

  &lt;a class = "footer-icon-link" href = "https://fp-2022.netlify.app/"&gt;
    &lt;i class = "footer-icon" data-feather="globe"&gt;&lt;/i&gt;
  &lt;/a&gt;

  &lt;a class = "footer-icon-link" href = "https://github.com/uo-datasci-specialization/c3-fp-2022"&gt;
    &lt;i class = "footer-icon" data-feather="github"&gt;&lt;/i&gt;
  &lt;/a&gt;

  &lt;/span&gt;
  &lt;/div&gt;
  

---

# Agenda
* Discuss `map2_*` and `pmap_*` (parallel iterations)

* `walk()` and friends

* `modify()`

* `safely()`

* `reduce()`

---
# Learning objectives
* Understand the differences between `map`, `map2`, and `pmap`

* Know when to apply `walk` instead of `map`, and why it may be useful

* Understand the similarities and differences between `map` and `modify`

* Diagnose errors with `safely` and understand other situations where it may
be helpful

* Collapsing/reducing lists with `purrr::reduce()` or `base::Reduce()`

---
background-image:url(https://d33wubrfki0l68.cloudfront.net/7a545699ff7069a98329fcfbe6e42b734507eb16/211a5/diagrams/functionals/map2-arg.png)
background-size:contain
# `map2`

---
class: inverse-blue middle

# A few Examples
Basic simulations - iterating over two vectors

Plots by month, changing the title

---
# Simulation
* Simulate data from a normal distribution

	+ Vary `\(n\)` from 5 to 150 by increments of 5
	
--
	
	+ For each `\(n\)`, vary `\(\mu\)` from -2 to 2 by increments of 0.25


--
### How do we get all combinations

--
`expand.grid`

---
# Example `expand.grid`
### Bonus: It turns it into a data frame!

```r
ints &lt;- 1:3
lets &lt;- c("a", "b", "c")
expand.grid(ints, lets)
```

```
##   Var1 Var2
## 1    1    a
## 2    2    a
## 3    3    a
## 4    1    b
## 5    2    b
## 6    3    b
## 7    1    c
## 8    2    c
## 9    3    c
```

---
# Set conditions

Please follow along


```r
conditions &lt;- expand.grid(
  n = seq(5, 150, 5),
  mu = seq(-2, 2, 0.25)
)
```

.pull-left[

```r
head(conditions)
```

```
##    n mu
## 1  5 -2
## 2 10 -2
## 3 15 -2
## 4 20 -2
## 5 25 -2
## 6 30 -2
```
]

.pull-right[

```r
tail(conditions)
```

```
##       n mu
## 505 125  2
## 506 130  2
## 507 135  2
## 508 140  2
## 509 145  2
## 510 150  2
```
]

---
# Simulate!


```r
sim1 &lt;- map2(conditions$n, conditions$mu, ~{
    rnorm(n = .x, mean = .y, sd = 10)
})
str(sim1)
```

```
## List of 510
##  $ : num [1:5] 9.47 11.21 -7.08 -9.52 14.75
##  $ : num [1:10] 5.53 -6.65 11.84 5.97 10.29 ...
##  $ : num [1:15] 5.36 -12.25 -4.77 -9.96 -24.12 ...
##  $ : num [1:20] -13.776 0.971 -4.511 3.479 -3.309 ...
##  $ : num [1:25] -10.3897 0.0782 5.7215 8.8343 6.5607 ...
##  $ : num [1:30] -12.49 7.42 -5.95 -9.56 -22.72 ...
##  $ : num [1:35] 7.098 -0.351 -4.839 0.802 11.27 ...
##  $ : num [1:40] 0.238 -0.162 9.217 -10.91 -9.475 ...
##  $ : num [1:45] -15.36 -4.17 -1.1 -5.25 9.51 ...
##  $ : num [1:50] 2.647 -9.012 -16.856 -0.585 -2.493 ...
##  $ : num [1:55] 2.05 -11.7 1.02 6.81 -12.34 ...
##  $ : num [1:60] 0.841 4.746 -15.114 2.418 -25.436 ...
##  $ : num [1:65] 18.11 -5.65 13.83 -4.19 6.15 ...
##  $ : num [1:70] 4.92 6.8 -20.73 4.92 4.92 ...
##  $ : num [1:75] 1.208 -8.579 -13.281 -13.267 0.666 ...
##  $ : num [1:80] -1.02 -8.1 -7.58 -18.32 -1.62 ...
##  $ : num [1:85] -6.12 -1.57 -5.89 -19.54 -9.57 ...
##  $ : num [1:90] 9.4 -0.217 1.298 2.209 4.611 ...
##  $ : num [1:95] 0.366 2.115 4.806 3.638 19.459 ...
##  $ : num [1:100] -18.3135 -3.1749 16.586 11.7585 -0.0731 ...
##  $ : num [1:105] -3.38 1.58 1.36 0.84 4.28 ...
##  $ : num [1:110] -11.389 -3.805 1.673 0.933 8.449 ...
##  $ : num [1:115] -13.108 0.155 -7.2 10.176 -0.681 ...
##  $ : num [1:120] -19.47 -9.04 -2.54 -3.8 6.59 ...
##  $ : num [1:125] 15.71 -7.87 21.22 7.74 -1.37 ...
##  $ : num [1:130] -7.24 -16.48 -19.49 3.75 2.69 ...
##  $ : num [1:135] 5.16 -13.4 -17.07 3.1 5.99 ...
##  $ : num [1:140] 6.206 15.319 -0.779 -10.064 -0.77 ...
##  $ : num [1:145] 0.712 -6.108 11.537 -7.497 -3.861 ...
##  $ : num [1:150] -5.27 -1.36 -1.69 10.95 4.15 ...
##  $ : num [1:5] 4.3 -19.14 -9.11 -4.06 13.79
##  $ : num [1:10] -6.36 -4.02 1.03 10.39 -5 ...
##  $ : num [1:15] -1.65 -5.75 14.04 -12.92 -26.56 ...
##  $ : num [1:20] -6.07 -2.2 5.57 6.01 -13.68 ...
##  $ : num [1:25] -1.99 6.66 -17.19 19.46 -6.84 ...
##  $ : num [1:30] 9.92 8.49 -3.37 -7.26 -8.26 ...
##  $ : num [1:35] 6.08 6.01 -12.46 -5.43 -11.23 ...
##  $ : num [1:40] 3.63 -22.94 5.93 12.01 -4.64 ...
##  $ : num [1:45] 1.71 -19.48 -2.61 -7.06 26.77 ...
##  $ : num [1:50] -11.884 -0.0246 0.9706 -7.6307 -15.5724 ...
##  $ : num [1:55] -0.136 1.433 4.331 19.813 -8.625 ...
##  $ : num [1:60] 5.38 12.16 -3.93 14.43 3.17 ...
##  $ : num [1:65] 17.412 15.526 -6.115 0.721 -18.216 ...
##  $ : num [1:70] 3.01 13.64 1.49 2.12 -2.24 ...
##  $ : num [1:75] 7.93 -13.47 -8.54 2.46 -14.33 ...
##  $ : num [1:80] -0.282 -15.442 -6.598 11.766 3.849 ...
##  $ : num [1:85] -6.61 -1.52 -4.71 -7.76 -13.18 ...
##  $ : num [1:90] -8.6 15.6 6.78 -1.78 -17.61 ...
##  $ : num [1:95] 0.748 1.603 14.691 3.403 -10.282 ...
##  $ : num [1:100] 10.78 -16.74 2.56 13.77 -9.48 ...
##  $ : num [1:105] 4.339 14.48 6.08 12.931 -0.807 ...
##  $ : num [1:110] -6.27 -14.21 -2.28 -12.6 1.96 ...
##  $ : num [1:115] -8.8788 4.6418 -0.0873 -17.9503 -1.7514 ...
##  $ : num [1:120] 1.65 -5.09 -16.35 -3.56 9.38 ...
##  $ : num [1:125] 4.53 -2.98 -10.16 -2.12 -2.54 ...
##  $ : num [1:130] 7.6 -8.63 5.54 18.09 -5.23 ...
##  $ : num [1:135] -10.44 -12.68 -3.34 9.68 -5.31 ...
##  $ : num [1:140] -18.25 -18.19 -10.2 5.08 -10.71 ...
##  $ : num [1:145] -5.48 -6.92 -6.72 -20.72 -1.63 ...
##  $ : num [1:150] 9.48 -6.92 23.15 5.69 1.76 ...
##  $ : num [1:5] -7.69 12.46 -7.32 7.35 -9.46
##  $ : num [1:10] 13.62 1.52 -9.01 -5.54 -3.15 ...
##  $ : num [1:15] -1.557 1.411 -2.644 -0.911 16.499 ...
##  $ : num [1:20] -12.783 0.518 18.806 9.811 2.378 ...
##  $ : num [1:25] -7.27 -2.51 3.52 -1.37 5.79 ...
##  $ : num [1:30] -8.59 -12.19 10.39 8.41 -6.87 ...
##  $ : num [1:35] 1.16 -24.52 -9.09 -5.75 -20.34 ...
##  $ : num [1:40] -1.87 -8.02 -9.85 -10.51 13.28 ...
##  $ : num [1:45] -11.107 0.894 -18.625 6.641 -15.16 ...
##  $ : num [1:50] 13.96 8.46 6.47 -5.49 -3.78 ...
##  $ : num [1:55] -8.792 -8.923 0.409 6.637 -10.453 ...
##  $ : num [1:60] 5.766 17.439 -0.936 12.059 -12.523 ...
##  $ : num [1:65] -2.37 -1.22 -6.14 -11.32 -4.22 ...
##  $ : num [1:70] 0.053 -16.782 -6.115 -5.444 -3.398 ...
##  $ : num [1:75] -4.35 15.91 8.75 -8.07 -14.8 ...
##  $ : num [1:80] 5.48 6.53 -13.96 6.94 1.4 ...
##  $ : num [1:85] 11.767 20.492 0.273 -6.438 -5.153 ...
##  $ : num [1:90] -2.53 -9.85 7.97 6.38 -12.32 ...
##  $ : num [1:95] -6.45 3.46 -8.21 -3.11 -11.51 ...
##  $ : num [1:100] -4.89 6.52 -7.35 2.67 -1.07 ...
##  $ : num [1:105] 14.769 -7.72 5.717 -0.329 -8.421 ...
##  $ : num [1:110] -1.6611 -6.7562 0.0161 2.9339 -0.9139 ...
##  $ : num [1:115] -2.33 19.91 -8.11 -3.39 -1.54 ...
##  $ : num [1:120] -15.111 -18.736 -13.864 0.201 3.019 ...
##  $ : num [1:125] 2.2 -8.3 -11 -11.5 11.2 ...
##  $ : num [1:130] -4.44 8.12 12.17 1.26 -7.22 ...
##  $ : num [1:135] 18.21 -18.29 3.89 8.2 5.52 ...
##  $ : num [1:140] -10.26 -4.33 -3.68 13.19 -9.92 ...
##  $ : num [1:145] -10.9 -4.19 6.1 -5.7 -7.81 ...
##  $ : num [1:150] -1.38 15.99 -7.44 -34.84 6.76 ...
##  $ : num [1:5] 0.813 -3.522 17.905 6.975 -4.051
##  $ : num [1:10] 6.552 4.251 -0.388 -8.236 0.576 ...
##  $ : num [1:15] 5.919 10.513 5.267 0.138 -4.932 ...
##  $ : num [1:20] 13.43 6.62 13.31 20.71 5.19 ...
##  $ : num [1:25] 14.734 4.133 0.945 -18.096 4.107 ...
##  $ : num [1:30] -3.35 -6.91 7.59 -1.54 3.23 ...
##  $ : num [1:35] -15.79 -8.89 7.83 10.28 12.25 ...
##  $ : num [1:40] -20.0601 0.0915 5.7911 -5.1542 -2.0058 ...
##  $ : num [1:45] -8.15 -6.85 -4.56 1.38 12.36 ...
##   [list output truncated]
```

---
# More powerful
### Add it as a list column!


```r
sim2 &lt;- conditions %&gt;%
  as_tibble() %&gt;% # Not required, but definitely helpful
  mutate(sim = map2(n, mu, ~rnorm(n = .x, mean = .y, sd = 10))) 
sim2
```

```
## # A tibble: 510 Ã— 3
##        n    mu sim       
##    &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1     5    -2 &lt;dbl [5]&gt; 
##  2    10    -2 &lt;dbl [10]&gt;
##  3    15    -2 &lt;dbl [15]&gt;
##  4    20    -2 &lt;dbl [20]&gt;
##  5    25    -2 &lt;dbl [25]&gt;
##  6    30    -2 &lt;dbl [30]&gt;
##  7    35    -2 &lt;dbl [35]&gt;
##  8    40    -2 &lt;dbl [40]&gt;
##  9    45    -2 &lt;dbl [45]&gt;
## 10    50    -2 &lt;dbl [50]&gt;
## # â€¦ with 500 more rows
```

---
# Unnest


```r
conditions %&gt;%
  as_tibble() %&gt;% 
  mutate(sim = map2(n, mu, ~rnorm(.x, .y, sd = 10))) %&gt;%
  unnest(sim)
```

```
## # A tibble: 39,525 Ã— 3
##        n    mu         sim
##    &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
##  1     5    -2  11.23609  
##  2     5    -2 -19.33569  
##  3     5    -2  20.63748  
##  4     5    -2  -4.236432 
##  5     5    -2  -1.626640 
##  6    10    -2 -14.53035  
##  7    10    -2  16.91659  
##  8    10    -2   0.7720395
##  9    10    -2   5.808367 
## 10    10    -2 -16.02990  
## # â€¦ with 39,515 more rows
```

---
# Challenge

Can you replicate what we just did, but using a `rowwise()` approach?

<div class="countdown" id="timer_623115cb" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

--

```r
conditions %&gt;% 
  rowwise() %&gt;% 
  mutate(sim = list(rnorm(n, mu, sd = 10))) %&gt;% 
  unnest(sim)
```

```
## # A tibble: 39,525 Ã— 3
##        n    mu        sim
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     5    -2  -6.617047
##  2     5    -2   8.366971
##  3     5    -2   7.079862
##  4     5    -2   5.905861
##  5     5    -2   6.570213
##  6    10    -2 -17.77516 
##  7    10    -2  -6.816531
##  8    10    -2 -10.39636 
##  9    10    -2  11.71602 
## 10    10    -2   3.212861
## # â€¦ with 39,515 more rows
```



---
class: inverse-orange middle
# Vary the sd too?

--
### `pmap`
Which we'll get to soon

---
class: inverse-blue middle
# Varying the title of a plot

---
# The data
Please follow along

```r
library(fivethirtyeight)
pulitzer
```

```
## # A tibble: 50 Ã— 7
##    newspaper             circ2004 circ2013 pctchg_circ num_finals1990_2003 num_finals2004_2014 num_finals1990_2014
##    &lt;chr&gt;                    &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;               &lt;int&gt;               &lt;int&gt;               &lt;int&gt;
##  1 USA Today              2192098  1674306         -24                   1                   1                   2
##  2 Wall Street Journal    2101017  2378827          13                  30                  20                  50
##  3 New York Times         1119027  1865318          67                  55                  62                 117
##  4 Los Angeles Times       983727   653868         -34                  44                  41                  85
##  5 Washington Post         760034   474767         -38                  52                  48                 100
##  6 New York Daily News     712671   516165         -28                   4                   2                   6
##  7 New York Post           642844   500521         -22                   0                   0                   0
##  8 Chicago Tribune         603315   414930         -31                  23                  15                  38
##  9 San Jose Mercury News   558874   583998           4                   4                   2                   6
## 10 Newsday                 553117   377744         -32                  12                   6                  18
## # â€¦ with 40 more rows
```

---
# Prep data


```r
pulitzer&lt;- pulitzer %&gt;%
  select(newspaper, starts_with("num")) %&gt;%
  pivot_longer(
    -newspaper,
    names_to = "year_range",
    values_to = "n",
    names_prefix = "num_finals"
  ) %&gt;% 
  mutate(year_range = str_replace_all(year_range, "_", "-")) %&gt;%
  filter(year_range != "1990-2014")

head(pulitzer)
```

```
## # A tibble: 6 Ã— 3
##   newspaper           year_range     n
##   &lt;chr&gt;               &lt;chr&gt;      &lt;int&gt;
## 1 USA Today           1990-2003      1
## 2 USA Today           2004-2014      1
## 3 Wall Street Journal 1990-2003     30
## 4 Wall Street Journal 2004-2014     20
## 5 New York Times      1990-2003     55
## 6 New York Times      2004-2014     62
```

---
# One plot


```r
wsj &lt;- pulitzer %&gt;%
	filter(newspaper == "Wall Street Journal")

ggplot(wsj, aes(n, year_range)) +
  geom_col(aes(fill = n)) +
  scale_fill_distiller(
    type = "seq",
    limits = c(0, max(pulitzer$n)),
    palette = "BuPu",
    direction = 1
  ) +
  scale_x_continuous(
    limits = c(0, max(pulitzer$n)),
    expand = c(0, 0)
  ) +
  guides(fill = "none") +
  labs(
    title = "Pulitzer Prize winners: Wall Street Journal",
    x = "Total number of winners",
    y = ""
  ) 
```

---
class: middle

![](w5_files/figure-html/unnamed-chunk-5-1.png)&lt;!-- --&gt;


---
# Nest data


```r
by_newspaper &lt;- pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest()

by_newspaper
```

```
## # A tibble: 50 Ã— 2
## # Groups:   newspaper [50]
##    newspaper             data            
##    &lt;chr&gt;                 &lt;list&gt;          
##  1 USA Today             &lt;tibble [2 Ã— 2]&gt;
##  2 Wall Street Journal   &lt;tibble [2 Ã— 2]&gt;
##  3 New York Times        &lt;tibble [2 Ã— 2]&gt;
##  4 Los Angeles Times     &lt;tibble [2 Ã— 2]&gt;
##  5 Washington Post       &lt;tibble [2 Ã— 2]&gt;
##  6 New York Daily News   &lt;tibble [2 Ã— 2]&gt;
##  7 New York Post         &lt;tibble [2 Ã— 2]&gt;
##  8 Chicago Tribune       &lt;tibble [2 Ã— 2]&gt;
##  9 San Jose Mercury News &lt;tibble [2 Ã— 2]&gt;
## 10 Newsday               &lt;tibble [2 Ã— 2]&gt;
## # â€¦ with 40 more rows
```


---
# Produce all plots
### You try first!
Don't worry about the correct title yet, if you don't want

<div class="countdown" id="timer_623117e8" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---


```r
by_newspaper %&gt;%
	mutate(
	  plot = map(
	    data, ~{
	      ggplot(aes(n, year_range)) +
	        geom_col(aes(fill = n)) +
          scale_fill_distiller(
            type = "seq",
            limits = c(0, max(pulitzer$n)),
            palette = "BuPu",
            direction = 1
          ) +
          scale_x_continuous(
            limits = c(0, max(pulitzer$n)),
            expand = c(0, 0)
          ) +
        guides(fill = "none") +
        labs(
          title = "Pulitzer Prize winners",
          x = "Total number of winners",
          y = ""
        )
      }
    )
  )
```

---
# Add title


```r
library(glue)

p &lt;- by_newspaper %&gt;%
	mutate(
	  plot = map2(
*    data, newspaper, ~{
	      ggplot(.x, aes(n, year_range)) +
	        geom_col(aes(fill = n)) +
          scale_fill_distiller(
            type = "seq",
            limits = c(0, max(pulitzer$n)),
            palette = "BuPu",
            direction = 1
          ) +
          scale_x_continuous(
            limits = c(0, max(pulitzer$n)),
            expand = c(0, 0)
          ) +
          guides(fill = "none") +
          labs(
*           title = glue("Pulitzer Prize winners: {.y}"),
            x = "Total number of winners",
            y = ""
          )
        }
	    )
    )
```

---

```r
p
```

```
## # A tibble: 50 Ã— 3
## # Groups:   newspaper [50]
##    newspaper             data             plot  
##    &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;
##  1 USA Today             &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  2 Wall Street Journal   &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  3 New York Times        &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  4 Los Angeles Times     &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  5 Washington Post       &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  6 New York Daily News   &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  7 New York Post         &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  8 Chicago Tribune       &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
##  9 San Jose Mercury News &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
## 10 Newsday               &lt;tibble [2 Ã— 2]&gt; &lt;gg&gt;  
## # â€¦ with 40 more rows
```

---
# Look at a couple plots

.pull-left[

```r
p$plot[[1]]
```

![](w5_files/figure-html/p1-1.png)&lt;!-- --&gt;

```r
p$plot[[3]]
```

![](w5_files/figure-html/p1-2.png)&lt;!-- --&gt;
]

.pull-right[

```r
p$plot[[2]]
```

![](w5_files/figure-html/p2-1.png)&lt;!-- --&gt;

```r
p$plot[[4]]
```

![](w5_files/figure-html/p2-2.png)&lt;!-- --&gt;
]

---
# Challenge
(You can probably guess where this is going)

--

## Can you reproduce the prior plots using a `rowwise()` approach?

<div class="countdown" id="timer_6231171d" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

```r
pulitzer %&gt;%
*nest_by(newspaper) %&gt;%
	mutate(
	  plot = list(
*    ggplot(data, aes(n, year_range)) +
        geom_col(aes(fill = n)) +
        scale_fill_distiller(
          type = "seq",
          limits = c(0, max(pulitzer$n)),
          palette = "BuPu",
          direction = 1
        ) +
        scale_x_continuous(
          limits = c(0, max(pulitzer$n)), 
          expand = c(0, 0)
        ) +
        guides(fill = "none") +
        labs(
*         title = glue("Pulitzer Prize winners: {newspaper}"),
          x = "Total number of winners",
          y = ""
        )
    )
  )
```

```
## # A tibble: 50 Ã— 3
## # Rowwise:  newspaper
##    newspaper                                  data plot  
##    &lt;chr&gt;                        &lt;list&lt;tibble[,2]&gt;&gt; &lt;list&gt;
##  1 Arizona Republic                        [2 Ã— 2] &lt;gg&gt;  
##  2 Atlanta Journal Constitution            [2 Ã— 2] &lt;gg&gt;  
##  3 Baltimore Sun                           [2 Ã— 2] &lt;gg&gt;  
##  4 Boston Globe                            [2 Ã— 2] &lt;gg&gt;  
##  5 Boston Herald                           [2 Ã— 2] &lt;gg&gt;  
##  6 Charlotte Observer                      [2 Ã— 2] &lt;gg&gt;  
##  7 Chicago Sun-Times                       [2 Ã— 2] &lt;gg&gt;  
##  8 Chicago Tribune                         [2 Ã— 2] &lt;gg&gt;  
##  9 Cleveland Plain Dealer                  [2 Ã— 2] &lt;gg&gt;  
## 10 Columbus Dispatch                       [2 Ã— 2] &lt;gg&gt;  
## # â€¦ with 40 more rows
```

---
class: inverse-red middle
# Iterating over `\(n\)` vectors
### `pmap`


---
background-image:url(https://d33wubrfki0l68.cloudfront.net/e426c5755e2e65bdcc073d387775db79791f32fd/92902/diagrams/functionals/pmap.png)
background-size:contain
# `pmap`


---
# Simulation
* Simulate data from a normal distribution

	+ Vary `\(n\)` from 5 to 150 by increments of 5

--
	+ For each `\(n\)`, vary `\(\mu\)` from -2 to 2 by increments of 0.25

--
	+ For each `\(\sigma\)` from 1 to 3 by increments of 0.1


---

```r
full_conditions &lt;- expand.grid(
  n = seq(5, 150, 5),
  mu = seq(-2, 2, 0.25),
  sd = seq(1, 3, .1)
)
```

.pull-left[

```r
head(full_conditions)
```

```
##    n mu sd
## 1  5 -2  1
## 2 10 -2  1
## 3 15 -2  1
## 4 20 -2  1
## 5 25 -2  1
## 6 30 -2  1
```
]

.pull-right[

```r
tail(full_conditions)
```

```
##         n mu sd
## 10705 125  2  3
## 10706 130  2  3
## 10707 135  2  3
## 10708 140  2  3
## 10709 145  2  3
## 10710 150  2  3
```
]

---
# Full Simulation


```r
fsim &lt;- pmap(
  list(
    number = full_conditions$n,
    average = full_conditions$mu,
    stdev = full_conditions$sd
  ), 
  function(number, average, stdev) {
    rnorm(n = number, mean = average, sd = stdev)
  }
)
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -2.69 -1.13 -2.56 -2.81 -3.09
##  $ : num [1:10] -3.867 -1.429 -1.567 -0.964 -1.355 ...
##  $ : num [1:15] -1.913 -2.158 -3.85 0.209 -3.776 ...
##  $ : num [1:20] -2.96 -1.44 -2.49 -3.51 -3.02 ...
##  $ : num [1:25] -3.232 0.512 -1.843 -1.531 -1.217 ...
##  $ : num [1:30] -0.84 -2.23 -2.12 -1.15 -1.59 ...
##  $ : num [1:35] -2.484 -0.561 -0.962 -0.574 -2.11 ...
##  $ : num [1:40] -3.769 -2.752 -0.915 -3.348 -2.75 ...
##  $ : num [1:45] -0.915 -2.217 -2.843 -2.104 -2.282 ...
##  $ : num [1:50] -0.796 -2.114 -3.433 -2.958 -2.386 ...
##  $ : num [1:55] -3.141 -3.462 -2.242 -1.983 -0.963 ...
##  $ : num [1:60] -2.12 -1.41 -2.07 -2.83 -3.35 ...
##  $ : num [1:65] -0.863 -1.961 -2.653 -3.141 -3.778 ...
##  $ : num [1:70] -1.706 -2.233 -2.757 -4.099 0.154 ...
##  $ : num [1:75] -1.274 -1.956 -1.734 -0.547 -2.611 ...
##  $ : num [1:80] -1.17 -1.91 -1.53 -3.28 -2.7 ...
##  $ : num [1:85] -2.33 -1.59 -3.07 -2.32 -1.62 ...
##  $ : num [1:90] -2.04 -2.69 -1.6 -2.22 -2.11 ...
##  $ : num [1:95] -1.83 -1.08 -2.22 -1.53 -2.01 ...
##  $ : num [1:100] -3.08 -1.82 -2.92 -2.53 -4.55 ...
##  $ : num [1:105] -0.883 -3.237 -2.482 -3.633 -1.596 ...
##  $ : num [1:110] -1.85 -1.31 -2.54 -1.76 -3.21 ...
##  $ : num [1:115] -1.06 -2.81 -2.53 -2.75 -1.44 ...
##  $ : num [1:120] -1.34 -1.73 -2.76 -2.18 -1.14 ...
##  $ : num [1:125] -2.25 -1.96 -3.73 -1.93 -1.05 ...
##  $ : num [1:130] -2.52 -2.97 -1.213 -3.536 -0.264 ...
##  $ : num [1:135] -2.788 -2.236 -2.915 -0.994 -3.989 ...
##  $ : num [1:140] -3.5 -2.96 -3.27 -2.79 -2.02 ...
##  $ : num [1:145] -2.73 -1.75 -1.94 -1.63 -2.15 ...
##  $ : num [1:150] -3.49 -2.87 -1.22 -2.03 -1.06 ...
##  $ : num [1:5] -2.389 -1.048 -1.242 -0.221 -1.731
##  $ : num [1:10] -1.747 -1.869 -0.717 -0.687 -1.289 ...
##  $ : num [1:15] -2.523 -0.664 -1.6 -2.248 -1.357 ...
##  $ : num [1:20] -3.35 -2.391 0.161 -1.888 -1.037 ...
##  $ : num [1:25] -0.551 -2.065 -1.492 -2.635 -2.617 ...
##  $ : num [1:30] -1.473 -0.754 -1.543 -2.876 -0.627 ...
##  $ : num [1:35] -1.695 -4.021 -0.927 -1.982 -0.549 ...
##  $ : num [1:40] -2.1 -2.76 -1.97 -1.29 -2.76 ...
##  $ : num [1:45] -2.062 -1.55 -0.914 -1.551 -1.106 ...
##  $ : num [1:50] -2.456 -0.705 -0.84 -1.648 -1.767 ...
##  $ : num [1:55] -1.433 -1.785 -2.414 -0.196 -0.457 ...
##  $ : num [1:60] -1.7 -1.33 -1.35 -0.57 -4.5 ...
##  $ : num [1:65] -2.269 -1.287 0.467 -1.492 -1.68 ...
##  $ : num [1:70] -3.736 -2.235 -3.208 -0.542 -0.943 ...
##  $ : num [1:75] -2.242 -1.972 -2.181 -0.742 -3.183 ...
##  $ : num [1:80] -0.52 -0.575 -3.026 -2.379 -1.356 ...
##  $ : num [1:85] -2.684 -1.101 -3.051 -1.078 -0.939 ...
##  $ : num [1:90] -0.9867 -1.3501 -2.3196 -2.0275 -0.0682 ...
##  $ : num [1:95] -2.229 -0.565 -2.261 -0.719 -3.185 ...
##  $ : num [1:100] -1.898 -0.804 -1.821 -0.35 0.643 ...
##  $ : num [1:105] -2.48 -1.77 -1.85 -2.92 -1.84 ...
##  $ : num [1:110] -0.348 -2.363 -3.104 -1.715 -2.551 ...
##  $ : num [1:115] -2.825 0.558 -2.537 -1.458 -0.709 ...
##  $ : num [1:120] -2.38 -2.68 -1.11 -2.87 -2.01 ...
##  $ : num [1:125] -0.812 -2.272 -2.342 -3.021 -2.153 ...
##  $ : num [1:130] -1.27 -1.85 -1.36 -1.95 -1.52 ...
##  $ : num [1:135] -0.396 -1.38 -2.75 -1.001 -0.304 ...
##  $ : num [1:140] -3.576 -0.809 -1.854 -0.889 -3.785 ...
##  $ : num [1:145] -3.533 -1.548 -1.311 -0.961 -1.012 ...
##  $ : num [1:150] -2.52 -1.97 -2.58 -4.19 -2.51 ...
##  $ : num [1:5] -3.04 -3.59 -1.96 -1.09 -1.61
##  $ : num [1:10] -1.386 -0.934 -2.989 -2.965 -1.018 ...
##  $ : num [1:15] -3.135 -2.099 -0.14 -1.519 -0.106 ...
##  $ : num [1:20] -0.219 1.209 -1.073 -1.595 -1.923 ...
##  $ : num [1:25] -1.786 -0.89 -2.279 -1.332 -0.401 ...
##  $ : num [1:30] -3.0584 -0.9156 0.0886 -0.9157 -1.6513 ...
##  $ : num [1:35] -0.1 -2.15 -2.62 1.3 -2.36 ...
##  $ : num [1:40] 0.056 -0.6 -2.136 -1.955 -1.007 ...
##  $ : num [1:45] -3.3 -2.12 -2.17 -0.68 -3.38 ...
##  $ : num [1:50] -2.356 -1.676 -0.838 -1.991 -1.012 ...
##  $ : num [1:55] -1.155 -2.406 -0.575 -1.488 -2.09 ...
##  $ : num [1:60] -1.535 -1.245 -1.847 -1.178 -0.614 ...
##  $ : num [1:65] 0.0769 -1.9499 -1.2266 -1.3917 -2.739 ...
##  $ : num [1:70] -3.231 -0.997 -0.578 -1.972 -2.523 ...
##  $ : num [1:75] 0.478 -1.848 -1.052 -2.684 0.732 ...
##  $ : num [1:80] -1.8406 -0.6408 -0.0653 -1.4192 -2.2395 ...
##  $ : num [1:85] -1.151 -3.031 -0.199 -1.372 -0.694 ...
##  $ : num [1:90] -0.177 -1.639 -1.455 -1.521 -0.924 ...
##  $ : num [1:95] -0.838 -1.789 -2.627 -2.101 -1.93 ...
##  $ : num [1:100] -1.76 -1.89 -1.93 -2.62 -1.74 ...
##  $ : num [1:105] -1.219 -2.114 -1.551 -0.922 -1.497 ...
##  $ : num [1:110] -1.89194 -4.04348 0.23915 0.00139 -0.21425 ...
##  $ : num [1:115] -2.33 -1.93 -1.99 -3.48 -1.65 ...
##  $ : num [1:120] -0.49 -2.43 -2.06 -1.17 -3.54 ...
##  $ : num [1:125] -1.196 -0.759 -1.435 -0.793 -2.364 ...
##  $ : num [1:130] -2.358 -0.398 -0.634 -0.923 -2.351 ...
##  $ : num [1:135] 1.35 -1.54 -1.35 -1.36 -1.36 ...
##  $ : num [1:140] -1.226 -2.057 -1.551 -0.974 -1.944 ...
##  $ : num [1:145] -1.546 -0.989 -3.184 -1.897 -2.044 ...
##  $ : num [1:150] -0.813 -0.755 -0.111 -2.141 -0.199 ...
##  $ : num [1:5] -1.816 -1.378 -1.522 -0.477 -0.842
##  $ : num [1:10] -1.146 -1.65 -2.668 0.364 -2.09 ...
##  $ : num [1:15] -0.64 -2.4 -0.236 -1.375 0.409 ...
##  $ : num [1:20] -0.256 -1.799 -1.401 -0.239 -1.304 ...
##  $ : num [1:25] -1.34 -4.45 -1.32 -1.08 -3.26 ...
##  $ : num [1:30] -1.987 -0.533 -1.172 0.213 -0.63 ...
##  $ : num [1:35] -2.235 -0.846 -1.356 -0.132 -0.99 ...
##  $ : num [1:40] -1.304 -1.407 -0.975 -1.297 -1.858 ...
##  $ : num [1:45] -1.677 -1.34 -1.631 -0.829 -2.211 ...
##   [list output truncated]
```

---
# Alternative spec


```r
fsim &lt;- pmap(
  list(
    full_conditions$n,
    full_conditions$mu,
    full_conditions$sd
  ),
  ~rnorm(n = ..1, mean = ..2, sd = ..3)
)
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -1.042 -2.196 -0.969 -2.763 -1.576
##  $ : num [1:10] -2 -1.81 -1.86 -4.61 -2.96 ...
##  $ : num [1:15] -0.492 -2.355 -2.651 -2.468 -0.951 ...
##  $ : num [1:20] -1.92 -2.512 -1.415 -2.339 -0.969 ...
##  $ : num [1:25] -2.43 -1.7 -4.26 -1.14 -3.97 ...
##  $ : num [1:30] -3.554 -1.969 -1.428 -1.46 -0.276 ...
##  $ : num [1:35] -4.07 -1.72697 -3.03746 -1.54112 -0.00792 ...
##  $ : num [1:40] -1.98 -2.74 -2.38 -1.54 -1.17 ...
##  $ : num [1:45] -2.802 -2.193 0.462 -0.726 -1.645 ...
##  $ : num [1:50] -0.9602 -0.0473 -1.8664 -1.6328 -1.5447 ...
##  $ : num [1:55] -1.54 -1.72 -2.35 -2.31 -2.83 ...
##  $ : num [1:60] -0.927 -3.526 -2.883 -1.166 -1.988 ...
##  $ : num [1:65] -2.88 -1.22 -1.21 -3.33 -2.06 ...
##  $ : num [1:70] -2.053 -3.866 -1.362 -0.423 -2.869 ...
##  $ : num [1:75] -3.05 -1.42 -1.1 -1 -2.34 ...
##  $ : num [1:80] -1.758 -1.896 -3.399 -2.421 -0.599 ...
##  $ : num [1:85] 0.156 -1.482 -3.057 -2.394 -2.776 ...
##  $ : num [1:90] -1.42 -0.812 -2.226 -3.111 -1.708 ...
##  $ : num [1:95] -1.843 -1.183 -0.773 -2.116 -0.315 ...
##  $ : num [1:100] -2.01 -1.58 -2.27 -1.53 -1.57 ...
##  $ : num [1:105] -3.31 -1.35 -2.37 -1.83 -2.27 ...
##  $ : num [1:110] -3.03 -1.32 -3.29 -1.03 -2.56 ...
##  $ : num [1:115] -2.34 -1.7 -1.56 -1.82 -3.12 ...
##  $ : num [1:120] -2.883 -1.595 -1.871 -0.919 -2.064 ...
##  $ : num [1:125] -2.86 -1.07 -2.88 -1.68 -4.22 ...
##  $ : num [1:130] -1.73 -1.025 -1.803 -0.683 -1.039 ...
##  $ : num [1:135] -2.022 -2.82 0.152 -0.224 -1.634 ...
##  $ : num [1:140] -1.063 -1.371 -1.097 -2.2 -0.728 ...
##  $ : num [1:145] 0.443 -3.168 -2.398 -3.491 -2.221 ...
##  $ : num [1:150] -0.955 -1.27 -1.475 -2.257 -1.204 ...
##  $ : num [1:5] -2.88 -2.64 -1.96 -1.47 -1.53
##  $ : num [1:10] -0.751 -1.566 -2.882 -0.567 -0.369 ...
##  $ : num [1:15] -2.02 -1.34 -2.28 -2.18 -3.45 ...
##  $ : num [1:20] -0.94 -1.758 -2.063 -0.872 -2.641 ...
##  $ : num [1:25] -1.5 -1.56 -1.35 -1.65 -2.44 ...
##  $ : num [1:30] -1.03 -2.22 -3.51 -1.49 -3.53 ...
##  $ : num [1:35] -1.85 -0.48 -2.99 -2.32 -2.1 ...
##  $ : num [1:40] -1.631 -3.53 0.218 -1.735 -1.104 ...
##  $ : num [1:45] -1.326 -2.871 -1.323 -0.389 -2.363 ...
##  $ : num [1:50] -1.11682 -0.50702 -2.67623 -2.16645 0.00554 ...
##  $ : num [1:55] -1.26 1.25 -4.06 -2.46 -2.83 ...
##  $ : num [1:60] -1.389 -2.092 -0.456 -3.129 -1.513 ...
##  $ : num [1:65] -0.4 -0.992 -2.008 -1.572 -2.044 ...
##  $ : num [1:70] -2.875 -1.034 -0.723 0.226 -2.188 ...
##  $ : num [1:75] -1.1859 -1.4071 -2.7015 0.0236 -0.376 ...
##  $ : num [1:80] -1.986 -0.489 -0.799 -2.616 -0.849 ...
##  $ : num [1:85] -1.091 -0.437 -1.072 -0.336 -1.531 ...
##  $ : num [1:90] -3.795 -0.984 -3.194 -3.022 -0.881 ...
##  $ : num [1:95] 0.116 -1.106 -0.835 -1.582 -1.071 ...
##  $ : num [1:100] -1.25 -1.29 -2.05 -1.84 -1.66 ...
##  $ : num [1:105] -2.3773 -0.0982 -1.5947 -0.0548 -2.1648 ...
##  $ : num [1:110] -2.289 -1.875 -2.135 -2.458 -0.836 ...
##  $ : num [1:115] -2.041 -1.817 -0.726 -1.574 -3.187 ...
##  $ : num [1:120] -1.827 -2.512 -1.638 -0.677 -2.805 ...
##  $ : num [1:125] -0.78 -0.336 -1.672 -0.013 -0.757 ...
##  $ : num [1:130] -2.2038 0.0356 -2.6898 -0.9794 -0.892 ...
##  $ : num [1:135] -2.48 -1.85 -1.41 -1.97 -1.75 ...
##  $ : num [1:140] -2.5 -3.11 -1.66 -3.11 -2.15 ...
##  $ : num [1:145] -3.489 -1.329 -1.862 -0.962 -2.473 ...
##  $ : num [1:150] -2.998 -2.381 -1.65 -0.301 -0.889 ...
##  $ : num [1:5] 0.123 -1.644 -1.795 -0.602 -2.661
##  $ : num [1:10] -1.33 -1.43 -1.82 -1.59 -2.02 ...
##  $ : num [1:15] 0.0879 -1.3426 -1.5491 -0.6315 -0.9476 ...
##  $ : num [1:20] -2.362 -3.115 -1.664 -0.133 -1.465 ...
##  $ : num [1:25] -0.0667 -0.702 -1.247 -1.9805 -0.6993 ...
##  $ : num [1:30] -1.629 1.787 -1.463 -1.221 0.325 ...
##  $ : num [1:35] -0.0952 -0.5899 0.2252 -1.3942 -2.3531 ...
##  $ : num [1:40] -2.652 -2.1 -0.505 -0.952 -1.18 ...
##  $ : num [1:45] -1.351 -0.253 -1.346 -1.078 -2.405 ...
##  $ : num [1:50] -2.129 -0.064 -1.814 -1.521 -1.743 ...
##  $ : num [1:55] -2.13 -2.21 -0.96 -1.07 -1.06 ...
##  $ : num [1:60] -0.608 -1.801 -1.852 -0.889 -2.82 ...
##  $ : num [1:65] 0.0925 -2.2991 -2.161 -0.3902 -1.6904 ...
##  $ : num [1:70] -0.854 -3.06 -0.967 -2.506 -0.711 ...
##  $ : num [1:75] -0.446 -2.572 -0.494 -0.146 -1.736 ...
##  $ : num [1:80] -2.37 -1.26 -2.01 -1.01 -1.36 ...
##  $ : num [1:85] -0.136 -2.8751 0.0921 -2.6384 -1.1687 ...
##  $ : num [1:90] -0.62 -0.77 -0.625 -0.121 -0.692 ...
##  $ : num [1:95] -1.01 -1.02 -1.9 -2.35 -3.54 ...
##  $ : num [1:100] -1.894 -3.006 0.496 -3.373 -1.85 ...
##  $ : num [1:105] -1.18 -3.7 -1.01 -1.67 -1.49 ...
##  $ : num [1:110] -0.998 -1.531 -0.966 0.124 -1.561 ...
##  $ : num [1:115] -1.072 -1.582 -1.139 -3.038 -0.823 ...
##  $ : num [1:120] -1.166 -0.548 -0.748 -0.703 -2.419 ...
##  $ : num [1:125] -2.515 -0.208 -1.796 -1.963 -0.872 ...
##  $ : num [1:130] -2.173 -3.628 -0.585 -1.5 -1.48 ...
##  $ : num [1:135] -1.27 -2.59 -1.99 -1.52 -2.03 ...
##  $ : num [1:140] -2.44 -1.5 -1.87 1.09 -1.32 ...
##  $ : num [1:145] -1.346 -0.297 -3.924 -1.992 -2.319 ...
##  $ : num [1:150] -1.746 -2.231 -2.54 -3.076 -0.332 ...
##  $ : num [1:5] -2.64 -1.026 -1.395 -0.261 -1.48
##  $ : num [1:10] -2.15 -2.28 -1.47 -1.09 -2.16 ...
##  $ : num [1:15] -1.584 -2.413 -0.827 -1.236 -1.705 ...
##  $ : num [1:20] 0.251 -3.181 -1.154 -0.314 -1.723 ...
##  $ : num [1:25] -3.118 -1.331 -1.78 -0.932 -2.431 ...
##  $ : num [1:30] -1.87 -2.15 -1.17 -1.37 -3.12 ...
##  $ : num [1:35] -2.178 -1.199 -0.418 -0.151 -3.078 ...
##  $ : num [1:40] -0.82 -1.32 -1.78 -2.72 -1.6 ...
##  $ : num [1:45] -1.779 -0.102 -1.806 -0.81 -1.669 ...
##   [list output truncated]
```

---
# Simpler
### Maybe a little too clever
* A data frame is a list so...


```r
fsim &lt;- pmap(
  full_conditions,
  ~rnorm(n = ..1, mean = ..2, sd = ..3)
)
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -3.705 -0.907 -3.069 -2.746 -1.356
##  $ : num [1:10] -0.984 -2.316 -2.465 -1.896 -1.651 ...
##  $ : num [1:15] -1.9 -3.23 -1.47 -1.18 -1.44 ...
##  $ : num [1:20] -2.73 -1.73 -2.775 -0.321 -1.173 ...
##  $ : num [1:25] -2.864 -2.244 -0.483 -0.422 -2.011 ...
##  $ : num [1:30] -1.288 -4.209 -1.85 -0.922 0.17 ...
##  $ : num [1:35] -0.772 -1.375 -1.177 -2.744 -2.904 ...
##  $ : num [1:40] -1.74 -2.48 -1.59 -2.4 -0.32 ...
##  $ : num [1:45] -2.53 -1.35 -3.34 -3.43 -1.87 ...
##  $ : num [1:50] -1.36 -1.42 -3.89 -1.84 -2.14 ...
##  $ : num [1:55] -0.96 -2.814 -2.812 -2.169 -0.218 ...
##  $ : num [1:60] -3.67 -1.49 -2.34 -2.31 -2.08 ...
##  $ : num [1:65] -2.287 -1.309 -0.235 -1.822 -3.183 ...
##  $ : num [1:70] -2.55 -2.93 -2.71 -2 -2.89 ...
##  $ : num [1:75] -4.772 -1.43 -2.195 0.847 -2.041 ...
##  $ : num [1:80] -0.471 -1.131 -1.907 -2.699 -2.373 ...
##  $ : num [1:85] -4.08 -2.7 -1.77 -1.95 -3.34 ...
##  $ : num [1:90] -1.504 -0.764 -2.874 -0.753 -2.892 ...
##  $ : num [1:95] -2.17 -0.971 -1.399 -1.217 -3.261 ...
##  $ : num [1:100] -2.6 -2.14 -2.81 -1.83 -1.73 ...
##  $ : num [1:105] -3.02 -1.85 -1.35 -2.31 -3.99 ...
##  $ : num [1:110] -4.421 0.118 -2.767 -2.695 -1.756 ...
##  $ : num [1:115] -1.94 -2.7 -2.72 -3.23 -1.76 ...
##  $ : num [1:120] -0.592 -2.454 -2.368 -2.414 -3.645 ...
##  $ : num [1:125] -1.84 -2.4 -3.87 -1.26 -1.72 ...
##  $ : num [1:130] -1.65 -1.89 -1.02 -2.05 -2.63 ...
##  $ : num [1:135] -2.57 -2.84 -1.16 -3.02 -2.09 ...
##  $ : num [1:140] -2.42 -2.69 -2.89 -1.7 -3.16 ...
##  $ : num [1:145] -2.298 -1.833 -0.521 -0.732 -3.5 ...
##  $ : num [1:150] -0.301 -1.033 -1.613 -1.949 -1.951 ...
##  $ : num [1:5] -2.89 -1.37 -3.14 -1.4 -1.36
##  $ : num [1:10] -2.59 -2.79 -1.04 -1.71 -2.56 ...
##  $ : num [1:15] -2.2 -2.29 -2.42 -1.26 -2.28 ...
##  $ : num [1:20] -1.99 -1.71 -2.29 -2.08 -1.58 ...
##  $ : num [1:25] -0.514 -1.397 -1.384 -0.49 -2.314 ...
##  $ : num [1:30] -1.125 -1.986 -0.272 -2.257 -1.705 ...
##  $ : num [1:35] -2.961 -1.31 -0.967 -2.945 -2.486 ...
##  $ : num [1:40] -1.95 -2.46 -1.89 -1.26 -2.52 ...
##  $ : num [1:45] -1.85 -1.76 -2.9 -1.04 -1.57 ...
##  $ : num [1:50] -1.483 -1.847 -1.83 0.361 -0.283 ...
##  $ : num [1:55] -2.45 -2.23 -2.58 -1.93 -2.52 ...
##  $ : num [1:60] -2.51 -1.04 -1.21 -2.02 -1.21 ...
##  $ : num [1:65] -3.31 -2.84 -2.89 -4.08 -2.98 ...
##  $ : num [1:70] -2.126 -2.382 -0.462 -2.058 -1.644 ...
##  $ : num [1:75] -2.76 -2.14 -2.42 -1.09 -2.85 ...
##  $ : num [1:80] -1.7195 -0.0888 -1.3849 -1.5297 -3.2354 ...
##  $ : num [1:85] 0.0607 -1.2392 -0.903 -0.9594 -2.4457 ...
##  $ : num [1:90] -1.47 -1.71 -1.69 -2.51 -2.87 ...
##  $ : num [1:95] -1.534 -0.324 -2.43 -0.685 -3.79 ...
##  $ : num [1:100] -2.09 -0.45 -2.53 -0.74 -3.12 ...
##  $ : num [1:105] -3.609 -2.708 -0.828 -1.45 -1.256 ...
##  $ : num [1:110] -0.973 -2.162 -1.457 -3.766 -0.582 ...
##  $ : num [1:115] -0.5306 -0.0388 -1.931 -3.4679 -2.8529 ...
##  $ : num [1:120] -3.45 -2.15 -3.11 -1.14 -1.29 ...
##  $ : num [1:125] -0.905 -1.133 -2.175 -1.407 -1.063 ...
##  $ : num [1:130] -1.58 -1.87 -1.52 -2.79 -1.13 ...
##  $ : num [1:135] -2.6148 -2.724 -2.3717 -0.0743 -1.8717 ...
##  $ : num [1:140] -3.052 -1.51 -2.029 -1.843 -0.949 ...
##  $ : num [1:145] -3.2 -2.15 -2.82 -2.01 -1.2 ...
##  $ : num [1:150] -0.176 -0.749 -1.232 -2.41 -2.009 ...
##  $ : num [1:5] -1.2 -0.64 -0.56 -4.16 -1.62
##  $ : num [1:10] 0.053 -0.7428 0.1697 -3.9148 -0.0116 ...
##  $ : num [1:15] -2.456 -1.448 -2.368 -0.963 -1.529 ...
##  $ : num [1:20] -1.891 -0.823 -1.412 0.798 -2.395 ...
##  $ : num [1:25] -0.704 -0.933 -1.637 -2.55 -1.523 ...
##  $ : num [1:30] -3.13 -1.79 -2.8 -1.48 -1.6 ...
##  $ : num [1:35] -2.256 -1.838 -0.882 -2.108 -1.897 ...
##  $ : num [1:40] -1.69 -1.76 -1.34 -1.49 -1.22 ...
##  $ : num [1:45] -0.58 -0.671 -1.741 -1.692 -1.116 ...
##  $ : num [1:50] -1.403 -2.081 0.506 -3.211 -4.098 ...
##  $ : num [1:55] -2.07 -0.733 -0.232 -0.074 -1.69 ...
##  $ : num [1:60] -1.521 -1.669 -3.245 -2.095 -0.461 ...
##  $ : num [1:65] -2.27 -2.469 -2.034 -1.668 -0.735 ...
##  $ : num [1:70] -0.871 -1.436 -2.213 -0.226 -1.329 ...
##  $ : num [1:75] -1.31393 -3.39092 -1.17013 0.00596 -1.56202 ...
##  $ : num [1:80] -1.682 -3.022 -1.479 0.649 -0.248 ...
##  $ : num [1:85] -2.22 -1.84 -1.79 -1.53 -1.71 ...
##  $ : num [1:90] -0.318 -0.315 -4.294 -1.534 -1.284 ...
##  $ : num [1:95] -1.356 -1.57 -0.947 -0.413 -1.079 ...
##  $ : num [1:100] -3.03 -2.61 -1.26 -2.09 -1.74 ...
##  $ : num [1:105] -1 -1.91 -1.49 -2.2 -3.61 ...
##  $ : num [1:110] 0.0372 -1.2559 -0.2654 -0.7208 -3.006 ...
##  $ : num [1:115] -0.643 -2.08 -1.794 -1.65 -2.17 ...
##  $ : num [1:120] -0.734 -2.342 -1.07 -1.501 0.16 ...
##  $ : num [1:125] -2.379 -1.334 -1.679 -0.796 -1.027 ...
##  $ : num [1:130] -1.95 -1.92 -2.56 -1.5 -1.51 ...
##  $ : num [1:135] -4.1 -1.2 -1.76 -1.98 -3.5 ...
##  $ : num [1:140] -1.953 -1.859 -0.302 0.12 -1.661 ...
##  $ : num [1:145] -1.21 -1.03 -2.18 -3.25 -1.91 ...
##  $ : num [1:150] -0.0856 -3.4843 0.2109 -3.2251 -2.0731 ...
##  $ : num [1:5] -1.477 -2.095 -0.849 -2.211 -0.95
##  $ : num [1:10] -1.492 -1.442 -1.942 -0.392 -0.847 ...
##  $ : num [1:15] -0.792 -0.743 -1.8 -2.568 -0.288 ...
##  $ : num [1:20] -1.0884 -1.8697 -0.0502 -2.5421 -0.3748 ...
##  $ : num [1:25] -2.116 -0.381 -3.574 -2.795 -2.413 ...
##  $ : num [1:30] -2.29 -2.25 -2.28 -2.07 -2.81 ...
##  $ : num [1:35] -2.953 -0.159 -0.47 -1.152 -1.809 ...
##  $ : num [1:40] -0.623 0.332 -3.211 -1.172 -0.958 ...
##  $ : num [1:45] -1.807 0.616 -2.027 -1.73 -0.627 ...
##   [list output truncated]
```



---
# List column version


```r
full_conditions %&gt;%
	as_tibble() %&gt;%
	mutate(sim = pmap(list(n, mu, sd), ~rnorm(..1, ..2, ..3)))
```

```
## # A tibble: 10,710 Ã— 4
##        n    mu    sd sim       
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1     5    -2     1 &lt;dbl [5]&gt; 
##  2    10    -2     1 &lt;dbl [10]&gt;
##  3    15    -2     1 &lt;dbl [15]&gt;
##  4    20    -2     1 &lt;dbl [20]&gt;
##  5    25    -2     1 &lt;dbl [25]&gt;
##  6    30    -2     1 &lt;dbl [30]&gt;
##  7    35    -2     1 &lt;dbl [35]&gt;
##  8    40    -2     1 &lt;dbl [40]&gt;
##  9    45    -2     1 &lt;dbl [45]&gt;
## 10    50    -2     1 &lt;dbl [50]&gt;
## # â€¦ with 10,700 more rows
```

---
# Unnest


```r
full_conditions %&gt;%
	as_tibble() %&gt;%
	mutate(sim = pmap(
	    list(n, mu, sd), ~rnorm(..1, ..2, ..3)
	  )
  ) %&gt;%
	unnest(sim)
```

```
## # A tibble: 830,025 Ã— 4
##        n    mu    sd        sim
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     5    -2     1 -3.279599 
##  2     5    -2     1 -3.463857 
##  3     5    -2     1 -1.351400 
##  4     5    -2     1 -1.890146 
##  5     5    -2     1 -1.665575 
##  6    10    -2     1 -2.070767 
##  7    10    -2     1 -1.621322 
##  8    10    -2     1 -2.847094 
##  9    10    -2     1 -0.5013484
## 10    10    -2     1 -2.259621 
## # â€¦ with 830,015 more rows
```

---
# Replicate with `nest_by()`
### You try first

<div class="countdown" id="timer_62311531" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

--

```r
full_conditions %&gt;% 
  rowwise() %&gt;% 
  mutate(sim = list(rnorm(n, mu, sd))) %&gt;% 
  unnest(sim)
```

```
## # A tibble: 830,025 Ã— 4
##        n    mu    sd        sim
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     5    -2     1 -0.7758622
##  2     5    -2     1 -2.208930 
##  3     5    -2     1 -2.674586 
##  4     5    -2     1 -3.309357 
##  5     5    -2     1 -2.722848 
##  6    10    -2     1 -1.191633 
##  7    10    -2     1 -3.199831 
##  8    10    -2     1 -3.458367 
##  9    10    -2     1 -1.735262 
## 10    10    -2     1 -2.885026 
## # â€¦ with 830,015 more rows
```

---
class: inverse-blue middle
# Plot
Add a caption stating the total number of Pulitzer prize winners across years

---
# Add column for total


```r
pulitzer &lt;- pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	mutate(tot = sum(n))
pulitzer
```

```
## # A tibble: 100 Ã— 4
## # Groups:   newspaper [50]
##    newspaper           year_range     n   tot
##    &lt;chr&gt;               &lt;chr&gt;      &lt;int&gt; &lt;int&gt;
##  1 USA Today           1990-2003      1     2
##  2 USA Today           2004-2014      1     2
##  3 Wall Street Journal 1990-2003     30    50
##  4 Wall Street Journal 2004-2014     20    50
##  5 New York Times      1990-2003     55   117
##  6 New York Times      2004-2014     62   117
##  7 Los Angeles Times   1990-2003     44    85
##  8 Los Angeles Times   2004-2014     41    85
##  9 Washington Post     1990-2003     52   100
## 10 Washington Post     2004-2014     48   100
## # â€¦ with 90 more rows
```

---
# Easiest way (imo)
Create a column to represent exactly the label you want.


```r
#install.packages("english")
library(english)
pulitzer &lt;- pulitzer %&gt;%
	mutate(
	  label = glue(
	    "{str_to_title(as.english(tot))} Total Pulitzer Awards"
    )
)
```

---

```r
select(pulitzer, newspaper, label)
```

```
## # A tibble: 100 Ã— 2
## # Groups:   newspaper [50]
##    newspaper           label                                      
##    &lt;chr&gt;               &lt;glue&gt;                                     
##  1 USA Today           Two Total Pulitzer Awards                  
##  2 USA Today           Two Total Pulitzer Awards                  
##  3 Wall Street Journal Fifty Total Pulitzer Awards                
##  4 Wall Street Journal Fifty Total Pulitzer Awards                
##  5 New York Times      One Hundred Seventeen Total Pulitzer Awards
##  6 New York Times      One Hundred Seventeen Total Pulitzer Awards
##  7 Los Angeles Times   Eighty-Five Total Pulitzer Awards          
##  8 Los Angeles Times   Eighty-Five Total Pulitzer Awards          
##  9 Washington Post     One Hundred Total Pulitzer Awards          
## 10 Washington Post     One Hundred Total Pulitzer Awards          
## # â€¦ with 90 more rows
```

---
# Produce one plot


```r
wsj2 &lt;- pulitzer %&gt;%
	filter(newspaper == "Wall Street Journal") 

ggplot(wsj2, aes(n, year_range)) +
  geom_col(aes(fill = n)) +
  scale_fill_distiller(
    type = "seq",
    limits = c(0, max(pulitzer$n)),
    palette = "BuPu",
    direction = 1
  ) +
  scale_x_continuous(
    limits = c(0, max(pulitzer$n)),
    expand = c(0, 0)
  ) +
  guides(fill = "none") +
  labs(
    title = glue("Pulitzer Prize winners: Wall Street Journal"),
    x = "Total number of winners",
    y = "",
    caption = unique(wsj2$label)
  )
```

---
class: middle

![](w5_files/figure-html/plot-cap1-eval-1.png)&lt;!-- --&gt;

---
# Produce all plots
### Nest first


```r
by_newspaper_label &lt;- pulitzer %&gt;%
	group_by(newspaper, label) %&gt;%
	nest() 

by_newspaper_label
```

```
## # A tibble: 50 Ã— 3
## # Groups:   newspaper, label [50]
##    newspaper             label                                       data            
##    &lt;chr&gt;                 &lt;glue&gt;                                      &lt;list&gt;          
##  1 USA Today             Two Total Pulitzer Awards                   &lt;tibble [2 Ã— 3]&gt;
##  2 Wall Street Journal   Fifty Total Pulitzer Awards                 &lt;tibble [2 Ã— 3]&gt;
##  3 New York Times        One Hundred Seventeen Total Pulitzer Awards &lt;tibble [2 Ã— 3]&gt;
##  4 Los Angeles Times     Eighty-Five Total Pulitzer Awards           &lt;tibble [2 Ã— 3]&gt;
##  5 Washington Post       One Hundred Total Pulitzer Awards           &lt;tibble [2 Ã— 3]&gt;
##  6 New York Daily News   Six Total Pulitzer Awards                   &lt;tibble [2 Ã— 3]&gt;
##  7 New York Post         Zero Total Pulitzer Awards                  &lt;tibble [2 Ã— 3]&gt;
##  8 Chicago Tribune       Thirty-Eight Total Pulitzer Awards          &lt;tibble [2 Ã— 3]&gt;
##  9 San Jose Mercury News Six Total Pulitzer Awards                   &lt;tibble [2 Ã— 3]&gt;
## 10 Newsday               Eighteen Total Pulitzer Awards              &lt;tibble [2 Ã— 3]&gt;
## # â€¦ with 40 more rows
```

---
# Produce plots


```r
final_plots &lt;- by_newspaper_label %&gt;%
	mutate(plots = pmap(list(newspaper, label, data), ~{
*   ggplot(..3, aes(n, year_range)) +
      geom_col(aes(fill = n)) +
      scale_fill_distiller(
        type = "seq",
        limits = c(0, max(pulitzer$n)),
        palette = "BuPu",
        direction = 1
      ) +
	    scale_x_continuous(
	      limits = c(0, max(pulitzer$n)),
	      expand = c(0, 0)
      ) +
	    guides(fill = "none") +
	    labs(
*      title = glue("Pulitzer Prize winners: {..1}"),
	      x = "Total number of winners",
	      y = "",
*      caption = ..2
	    )
	  })
)
```

---
# Look at a couple plots

.pull-left[

```r
final_plots$plots[[1]]
```

![](w5_files/figure-html/p3-1.png)&lt;!-- --&gt;

```r
final_plots$plots[[3]]
```

![](w5_files/figure-html/p3-2.png)&lt;!-- --&gt;
]

.pull-right[

```r
final_plots$plots[[2]]
```

![](w5_files/figure-html/p4-1.png)&lt;!-- --&gt;

```r
final_plots$plots[[4]]
```

![](w5_files/figure-html/p4-2.png)&lt;!-- --&gt;
]

---
# Replicate with `nest_by()`
You try first

<div class="countdown" id="timer_62311734" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

```r
final_plots2 &lt;- pulitzer %&gt;%
  ungroup() %&gt;% 
  nest_by(newspaper, label) %&gt;% 
	mutate(
	  plots = list(
	    ggplot(data, aes(n, year_range)) + 
	      geom_col(aes(fill = n)) +
        scale_fill_distiller(
          type = "seq",
          limits = c(0, max(pulitzer$n)),
          palette = "BuPu",
          direction = 1
        ) +
	      scale_x_continuous(
	        limits = c(0, max(pulitzer$n)), 
	        expand = c(0, 0)
        ) +
	      guides(fill = "none") +
	      labs(
	        title = glue("Pulitzer Prize winners: {newspaper}"),
	        x = "Total number of winners",
	        y = "",
	        caption = label
        )
	  )
)
```

---

```r
final_plots2
```

```
## # A tibble: 50 Ã— 4
## # Rowwise:  newspaper, label
##    newspaper                    label                                            data plots 
##    &lt;chr&gt;                        &lt;glue&gt;                             &lt;list&lt;tibble[,3]&gt;&gt; &lt;list&gt;
##  1 Arizona Republic             Seven Total Pulitzer Awards                   [2 Ã— 3] &lt;gg&gt;  
##  2 Atlanta Journal Constitution Six Total Pulitzer Awards                     [2 Ã— 3] &lt;gg&gt;  
##  3 Baltimore Sun                Thirteen Total Pulitzer Awards                [2 Ã— 3] &lt;gg&gt;  
##  4 Boston Globe                 Forty-One Total Pulitzer Awards               [2 Ã— 3] &lt;gg&gt;  
##  5 Boston Herald                Zero Total Pulitzer Awards                    [2 Ã— 3] &lt;gg&gt;  
##  6 Charlotte Observer           Four Total Pulitzer Awards                    [2 Ã— 3] &lt;gg&gt;  
##  7 Chicago Sun-Times            Two Total Pulitzer Awards                     [2 Ã— 3] &lt;gg&gt;  
##  8 Chicago Tribune              Thirty-Eight Total Pulitzer Awards            [2 Ã— 3] &lt;gg&gt;  
##  9 Cleveland Plain Dealer       Eleven Total Pulitzer Awards                  [2 Ã— 3] &lt;gg&gt;  
## 10 Columbus Dispatch            One Total Pulitzer Awards                     [2 Ã— 3] &lt;gg&gt;  
## # â€¦ with 40 more rows
```

---
# Save all plots

We'll have to iterate across at least two things: (a) file path/names, and (b)
the plots themselves


--
We can do this with the `map()` family, but instead we'll use a different function, which we'll talk about more next week.


--
As an aside, what are the **steps** we would need to take to do this?


--
Could we use a `nest_by()` solution?

---
# Try with `nest_by()`

You try first:
* Create a vector of file paths
* "loop" through the file paths and the plots to save them

<div class="countdown" id="timer_62311523" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">04</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Example

### Create a directory

```r
fs::dir_create(here::here("plots", "pulitzers"))
```

--
### Create file paths

```r
files &lt;- str_replace_all(
  tolower(final_plots$newspaper),
  " ",
  "-"
)
paths &lt;- here::here("plots", "pulitzers", glue("{files}.png"))
paths
```

```
##  [1] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/usa-today.png"                   
##  [2] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/wall-street-journal.png"         
##  [3] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-times.png"              
##  [4] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/los-angeles-times.png"           
##  [5] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/washington-post.png"             
##  [6] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-daily-news.png"         
##  [7] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-post.png"               
##  [8] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/chicago-tribune.png"             
##  [9] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/san-jose-mercury-news.png"       
## [10] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/newsday.png"                     
## [11] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/houston-chronicle.png"           
## [12] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/dallas-morning-news.png"         
## [13] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/san-francisco-chronicle.png"     
## [14] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/arizona-republic.png"            
## [15] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/chicago-sun-times.png"           
## [16] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/boston-globe.png"                
## [17] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/atlanta-journal-constitution.png"
## [18] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/newark-star-ledger.png"          
## [19] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/detroit-free-press.png"          
## [20] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/minneapolis-star-tribune.png"    
## [21] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/philadelphia-inquirer.png"       
## [22] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/cleveland-plain-dealer.png"      
## [23] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/san-diego-union-tribune.png"     
## [24] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/tampa-bay-times.png"             
## [25] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/denver-post.png"                 
## [26] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/rocky-mountain-news.png"         
## [27] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/oregonian.png"                   
## [28] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/miami-herald.png"                
## [29] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/orange-county-register.png"      
## [30] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/sacramento-bee.png"              
## [31] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/st.-louis-post-dispatch.png"     
## [32] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/baltimore-sun.png"               
## [33] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/kansas-city-star.png"            
## [34] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/detroit-news.png"                
## [35] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/orlando-sentinel.png"            
## [36] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/south-florida-sun-sentinel.png"  
## [37] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-orleans-times-picayune.png"  
## [38] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/columbus-dispatch.png"           
## [39] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/indianapolis-star.png"           
## [40] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/san-antonio-express-news.png"    
## [41] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/pittsburgh-post-gazette.png"     
## [42] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/milwaukee-journal-sentinel.png"  
## [43] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/tampa-tribune.png"               
## [44] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/fort-woth-star-telegram.png"     
## [45] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/boston-herald.png"               
## [46] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/seattle-times.png"               
## [47] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/charlotte-observer.png"          
## [48] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/daily-oklahoman.png"             
## [49] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/louisville-courier-journal.png"  
## [50] "/Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/investor's-buisiness-daily.png"
```

---
# Add paths to data frame

```r
final_plots %&gt;% 
* ungroup() %&gt;%
  mutate(path = paths) %&gt;% 
  select(plots, path)
```

```
## # A tibble: 50 Ã— 2
##    plots  path                                                                                                       
##    &lt;list&gt; &lt;chr&gt;                                                                                                      
##  1 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/usa-today.png            
##  2 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/wall-street-journal.png  
##  3 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-times.png       
##  4 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/los-angeles-times.png    
##  5 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/washington-post.png      
##  6 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-daily-news.png  
##  7 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-post.png        
##  8 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/chicago-tribune.png      
##  9 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/san-jose-mercury-news.png
## 10 &lt;gg&gt;   /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/newsday.png              
## # â€¦ with 40 more rows
```

---
# Save

```r
final_plots %&gt;% 
* ungroup() %&gt;%
  mutate(path = paths) %&gt;% 
* rowwise() %&gt;%
  summarize(
    ggsave(
      path, 
      plots, 
      width = 9.5, 
      height = 6.5,
      dpi = 500
    )
  )
```

```
## # A tibble: 50 Ã— 1
##    `ggsave(path, plots, width = 9.5, height = 6.5, dpi = 500)`                                                
##    &lt;chr&gt;                                                                                                      
##  1 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/usa-today.png            
##  2 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/wall-street-journal.png  
##  3 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-times.png       
##  4 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/los-angeles-times.png    
##  5 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/washington-post.png      
##  6 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-daily-news.png  
##  7 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/new-york-post.png        
##  8 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/chicago-tribune.png      
##  9 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/san-jose-mercury-news.png
## 10 /Users/daniel/Teaching/data_sci_specialization/2021-22/c3-fp-2022/plots/pulitzers/newsday.png              
## # â€¦ with 40 more rows
```

---
# Wrap-up
* Parallel iterations greatly increase the things you can do - iterating through at least two things simultaneously is pretty common


--
* The `nest_by()` approach can regularly get you the same result as `group_by() %&gt;% nest() %&gt;% mutate() %&gt;% map()`

  + Caveat - must be in a data frame, which means working with list columns
  
--
* My view - it's still worth learning both. Looping with **{purrr}** is super flexible and often safer than base versions (type safe). Doesn't have to be used within a data frame.

---
class: inverse-blue middle
# Break

---
class: inverse-red middle
# Looping variants

---
# Agenda
* `walk()` and friends

* `modify()`

* `safely()`

* `reduce()`

---
# Reminder
## Learning Objectives (for this part)

* Know when to apply `walk` instead of `map`, and why it may be useful

* Understand the parallels and differences between `map` and `modify`

* Diagnose errors with `safely` and understand other situations where it may
be helpful

* Collapsing/reducing lists with `purrr::reduce()` or `base::Reduce()`

---
# Setup
Let's go back to our plotting example:

## Saving
* We saw last time that we could use `nest_by()`
  + Required a bit of awkwardness with adding the paths to the data frame
  
--
* Instead, we'll do it again but with the `walk()` family


---
# Why `walk()`?

&gt; Walk is an alternative to map that you use when you want to call a function for its side effects, rather than for its return value. You typically do this because you want to render output to the screen or save files to disk - the important thing is the action, not the return value.

\-[r4ds](https://r4ds.had.co.nz/iteration.html#walk)

---
class: inverse-red middle
# More practical
If you use `walk()`, nothing will get printed to the screen. This is particularly helpful for RMarkdown files.

---
# Example
Please do the following
* Create a new RMarkdown document
* Paste the code you have for creating the plots in a code chunk there (along with the library loading, data cleaning, etc.)

<div class="countdown" id="timer_62311784" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Create a directory

We already did this, but in case we hadn't...

```r
fs::dir_create(here::here("plots", "pulitzers"))
```

--
### Create file paths

```r
newspapers &lt;- str_replace_all(
  tolower(final_plots$newspaper),
  " ",
  "-"
)
paths &lt;- here::here(
  "plots",
  "pulitzers",
  glue("{newspapers}.png")
)
```

---
# Challenge
* Use a `map()` family function to loop through `paths` and `final_plots$plots` to save all plots. 

* Render (knit) your file. What do you notice?

<div class="countdown" id="timer_62311836" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# `walk()`
Just like `map()`, we have parallel variants of `walk()`, including, `walk2()`, and `pwalk()`

These work just like `map()` but don't print to the screen

Try replacing your prior code with a `walk()` version. 

How does the rendered output change?

<div class="countdown" id="timer_62311800" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>


---
# Save plots


```r
walk2(paths, final_plots$plots, ggsave,
      width = 9.5, 
      height = 6.5,
      dpi = 500)
```

---
class: inverse-red middle
# modify

---
class: middle

&gt; Unlike `map()` and its variants which always return a fixed object type (list for `map()`, integer vector for `map_int()`, etc), the `modify()` family always returns the same type as the input object.

---
# `map` vs `modify`
### map


```r
map(mtcars, ~as.numeric(scale(.x)))
```

```
## $mpg
##  [1]  0.15088482  0.15088482  0.44954345  0.21725341 -0.23073453 -0.33028740 -0.96078893  0.71501778  0.44954345
## [10] -0.14777380 -0.38006384 -0.61235388 -0.46302456 -0.81145962 -1.60788262 -1.60788262 -0.89442035  2.04238943
## [19]  1.71054652  2.29127162  0.23384555 -0.76168319 -0.81145962 -1.12671039 -0.14777380  1.19619000  0.98049211
## [28]  1.71054652 -0.71190675 -0.06481307 -0.84464392  0.21725341
## 
## $cyl
##  [1] -0.1049878 -0.1049878 -1.2248578 -0.1049878  1.0148821 -0.1049878  1.0148821 -1.2248578 -1.2248578 -0.1049878
## [11] -0.1049878  1.0148821  1.0148821  1.0148821  1.0148821  1.0148821  1.0148821 -1.2248578 -1.2248578 -1.2248578
## [21] -1.2248578  1.0148821  1.0148821  1.0148821  1.0148821 -1.2248578 -1.2248578 -1.2248578  1.0148821 -0.1049878
## [31]  1.0148821 -1.2248578
## 
## $disp
##  [1] -0.57061982 -0.57061982 -0.99018209  0.22009369  1.04308123 -0.04616698  1.04308123 -0.67793094 -0.72553512
## [10] -0.50929918 -0.50929918  0.36371309  0.36371309  0.36371309  1.94675381  1.84993175  1.68856165 -1.22658929
## [19] -1.25079481 -1.28790993 -0.89255318  0.70420401  0.59124494  0.96239618  1.36582144 -1.22416874 -0.89093948
## [28] -1.09426581  0.97046468 -0.69164740  0.56703942 -0.88529152
## 
## $hp
##  [1] -0.53509284 -0.53509284 -0.78304046 -0.53509284  0.41294217 -0.60801861  1.43390296 -1.23518023 -0.75387015
## [10] -0.34548584 -0.34548584  0.48586794  0.48586794  0.48586794  0.85049680  0.99634834  1.21512565 -1.17683962
## [19] -1.38103178 -1.19142477 -0.72469984  0.04831332  0.04831332  1.43390296  0.41294217 -1.17683962 -0.81221077
## [28] -0.49133738  1.71102089  0.41294217  2.74656682 -0.54967799
## 
## $drat
##  [1]  0.56751369  0.56751369  0.47399959 -0.96611753 -0.83519779 -1.56460776 -0.72298087  0.17475447  0.60491932
## [10]  0.60491932  0.60491932 -0.98482035 -0.98482035 -0.98482035 -1.24665983 -1.11574009 -0.68557523  0.90416444
## [19]  2.49390411  1.16600392  0.19345729 -1.56460776 -0.83519779  0.24956575 -0.96611753  0.90416444  1.55876313
## [28]  0.32437703  1.16600392  0.04383473 -0.10578782  0.96027290
## 
## $wt
##  [1] -0.610399567 -0.349785269 -0.917004624 -0.002299538  0.227654255  0.248094592  0.360516446 -0.027849959
##  [9] -0.068730634  0.227654255  0.227654255  0.871524874  0.524039143  0.575139986  2.077504765  2.255335698
## [17]  2.174596366 -1.039646647 -1.637526508 -1.412682800 -0.768812180  0.309415603  0.222544170  0.636460997
## [25]  0.641571082 -1.310481114 -1.100967659 -1.741772228 -0.048290296 -0.457097039  0.360516446 -0.446876870
## 
## $qsec
##  [1] -0.77716515 -0.46378082  0.42600682  0.89048716 -0.46378082  1.32698675 -1.12412636  1.20387148  2.82675459
## [10]  0.25252621  0.58829513 -0.25112717 -0.13920420  0.08464175  0.07344945 -0.01608893 -0.23993487  0.90727560
## [19]  0.37564148  1.14790999  1.20946763 -0.54772305 -0.30708866 -1.36476075 -0.44699237  0.58829513 -0.64285758
## [28] -0.53093460 -1.87401028 -1.31439542 -1.81804880  0.42041067
## 
## $vs
##  [1] -0.8680278 -0.8680278  1.1160357  1.1160357 -0.8680278  1.1160357 -0.8680278  1.1160357  1.1160357  1.1160357
## [11]  1.1160357 -0.8680278 -0.8680278 -0.8680278 -0.8680278 -0.8680278 -0.8680278  1.1160357  1.1160357  1.1160357
## [21]  1.1160357 -0.8680278 -0.8680278 -0.8680278 -0.8680278  1.1160357 -0.8680278  1.1160357 -0.8680278 -0.8680278
## [31] -0.8680278  1.1160357
## 
## $am
##  [1]  1.1899014  1.1899014  1.1899014 -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431
## [11] -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431  1.1899014  1.1899014  1.1899014
## [21] -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431  1.1899014  1.1899014  1.1899014  1.1899014  1.1899014
## [31]  1.1899014  1.1899014
## 
## $gear
##  [1]  0.4235542  0.4235542  0.4235542 -0.9318192 -0.9318192 -0.9318192 -0.9318192  0.4235542  0.4235542  0.4235542
## [11]  0.4235542 -0.9318192 -0.9318192 -0.9318192 -0.9318192 -0.9318192 -0.9318192  0.4235542  0.4235542  0.4235542
## [21] -0.9318192 -0.9318192 -0.9318192 -0.9318192 -0.9318192  0.4235542  1.7789276  1.7789276  1.7789276  1.7789276
## [31]  1.7789276  0.4235542
## 
## $carb
##  [1]  0.7352031  0.7352031 -1.1221521 -1.1221521 -0.5030337 -1.1221521  0.7352031 -0.5030337 -0.5030337  0.7352031
## [11]  0.7352031  0.1160847  0.1160847  0.1160847  0.7352031  0.7352031  0.7352031 -1.1221521 -0.5030337 -1.1221521
## [21] -1.1221521 -0.5030337 -0.5030337  0.7352031 -0.5030337 -1.1221521 -0.5030337 -0.5030337  0.7352031  1.9734398
## [31]  3.2116766 -0.5030337
```

---
### modify


```r
modify(mtcars, ~as.numeric(scale(.x)))
```

```
##                             mpg        cyl        disp          hp        drat           wt        qsec         vs
## Mazda RX4            0.15088482 -0.1049878 -0.57061982 -0.53509284  0.56751369 -0.610399567 -0.77716515 -0.8680278
## Mazda RX4 Wag        0.15088482 -0.1049878 -0.57061982 -0.53509284  0.56751369 -0.349785269 -0.46378082 -0.8680278
## Datsun 710           0.44954345 -1.2248578 -0.99018209 -0.78304046  0.47399959 -0.917004624  0.42600682  1.1160357
## Hornet 4 Drive       0.21725341 -0.1049878  0.22009369 -0.53509284 -0.96611753 -0.002299538  0.89048716  1.1160357
## Hornet Sportabout   -0.23073453  1.0148821  1.04308123  0.41294217 -0.83519779  0.227654255 -0.46378082 -0.8680278
## Valiant             -0.33028740 -0.1049878 -0.04616698 -0.60801861 -1.56460776  0.248094592  1.32698675  1.1160357
## Duster 360          -0.96078893  1.0148821  1.04308123  1.43390296 -0.72298087  0.360516446 -1.12412636 -0.8680278
## Merc 240D            0.71501778 -1.2248578 -0.67793094 -1.23518023  0.17475447 -0.027849959  1.20387148  1.1160357
## Merc 230             0.44954345 -1.2248578 -0.72553512 -0.75387015  0.60491932 -0.068730634  2.82675459  1.1160357
## Merc 280            -0.14777380 -0.1049878 -0.50929918 -0.34548584  0.60491932  0.227654255  0.25252621  1.1160357
## Merc 280C           -0.38006384 -0.1049878 -0.50929918 -0.34548584  0.60491932  0.227654255  0.58829513  1.1160357
## Merc 450SE          -0.61235388  1.0148821  0.36371309  0.48586794 -0.98482035  0.871524874 -0.25112717 -0.8680278
## Merc 450SL          -0.46302456  1.0148821  0.36371309  0.48586794 -0.98482035  0.524039143 -0.13920420 -0.8680278
## Merc 450SLC         -0.81145962  1.0148821  0.36371309  0.48586794 -0.98482035  0.575139986  0.08464175 -0.8680278
## Cadillac Fleetwood  -1.60788262  1.0148821  1.94675381  0.85049680 -1.24665983  2.077504765  0.07344945 -0.8680278
## Lincoln Continental -1.60788262  1.0148821  1.84993175  0.99634834 -1.11574009  2.255335698 -0.01608893 -0.8680278
## Chrysler Imperial   -0.89442035  1.0148821  1.68856165  1.21512565 -0.68557523  2.174596366 -0.23993487 -0.8680278
## Fiat 128             2.04238943 -1.2248578 -1.22658929 -1.17683962  0.90416444 -1.039646647  0.90727560  1.1160357
## Honda Civic          1.71054652 -1.2248578 -1.25079481 -1.38103178  2.49390411 -1.637526508  0.37564148  1.1160357
## Toyota Corolla       2.29127162 -1.2248578 -1.28790993 -1.19142477  1.16600392 -1.412682800  1.14790999  1.1160357
## Toyota Corona        0.23384555 -1.2248578 -0.89255318 -0.72469984  0.19345729 -0.768812180  1.20946763  1.1160357
## Dodge Challenger    -0.76168319  1.0148821  0.70420401  0.04831332 -1.56460776  0.309415603 -0.54772305 -0.8680278
## AMC Javelin         -0.81145962  1.0148821  0.59124494  0.04831332 -0.83519779  0.222544170 -0.30708866 -0.8680278
## Camaro Z28          -1.12671039  1.0148821  0.96239618  1.43390296  0.24956575  0.636460997 -1.36476075 -0.8680278
## Pontiac Firebird    -0.14777380  1.0148821  1.36582144  0.41294217 -0.96611753  0.641571082 -0.44699237 -0.8680278
## Fiat X1-9            1.19619000 -1.2248578 -1.22416874 -1.17683962  0.90416444 -1.310481114  0.58829513  1.1160357
## Porsche 914-2        0.98049211 -1.2248578 -0.89093948 -0.81221077  1.55876313 -1.100967659 -0.64285758 -0.8680278
## Lotus Europa         1.71054652 -1.2248578 -1.09426581 -0.49133738  0.32437703 -1.741772228 -0.53093460  1.1160357
## Ford Pantera L      -0.71190675  1.0148821  0.97046468  1.71102089  1.16600392 -0.048290296 -1.87401028 -0.8680278
## Ferrari Dino        -0.06481307 -0.1049878 -0.69164740  0.41294217  0.04383473 -0.457097039 -1.31439542 -0.8680278
## Maserati Bora       -0.84464392  1.0148821  0.56703942  2.74656682 -0.10578782  0.360516446 -1.81804880 -0.8680278
## Volvo 142E           0.21725341 -1.2248578 -0.88529152 -0.54967799  0.96027290 -0.446876870  0.42041067  1.1160357
##                             am       gear       carb
## Mazda RX4            1.1899014  0.4235542  0.7352031
## Mazda RX4 Wag        1.1899014  0.4235542  0.7352031
## Datsun 710           1.1899014  0.4235542 -1.1221521
## Hornet 4 Drive      -0.8141431 -0.9318192 -1.1221521
## Hornet Sportabout   -0.8141431 -0.9318192 -0.5030337
## Valiant             -0.8141431 -0.9318192 -1.1221521
## Duster 360          -0.8141431 -0.9318192  0.7352031
## Merc 240D           -0.8141431  0.4235542 -0.5030337
## Merc 230            -0.8141431  0.4235542 -0.5030337
## Merc 280            -0.8141431  0.4235542  0.7352031
## Merc 280C           -0.8141431  0.4235542  0.7352031
## Merc 450SE          -0.8141431 -0.9318192  0.1160847
## Merc 450SL          -0.8141431 -0.9318192  0.1160847
## Merc 450SLC         -0.8141431 -0.9318192  0.1160847
## Cadillac Fleetwood  -0.8141431 -0.9318192  0.7352031
## Lincoln Continental -0.8141431 -0.9318192  0.7352031
## Chrysler Imperial   -0.8141431 -0.9318192  0.7352031
## Fiat 128             1.1899014  0.4235542 -1.1221521
## Honda Civic          1.1899014  0.4235542 -0.5030337
## Toyota Corolla       1.1899014  0.4235542 -1.1221521
## Toyota Corona       -0.8141431 -0.9318192 -1.1221521
## Dodge Challenger    -0.8141431 -0.9318192 -0.5030337
## AMC Javelin         -0.8141431 -0.9318192 -0.5030337
## Camaro Z28          -0.8141431 -0.9318192  0.7352031
## Pontiac Firebird    -0.8141431 -0.9318192 -0.5030337
## Fiat X1-9            1.1899014  0.4235542 -1.1221521
## Porsche 914-2        1.1899014  1.7789276 -0.5030337
## Lotus Europa         1.1899014  1.7789276 -0.5030337
## Ford Pantera L       1.1899014  1.7789276  0.7352031
## Ferrari Dino         1.1899014  1.7789276  1.9734398
## Maserati Bora        1.1899014  1.7789276  3.2116766
## Volvo 142E           1.1899014  0.4235542 -0.5030337
```


---


```r
map2(LETTERS[1:3], letters[1:3], paste0)
```

```
## [[1]]
## [1] "Aa"
## 
## [[2]]
## [1] "Bb"
## 
## [[3]]
## [1] "Cc"
```

```r
modify2(LETTERS[1:3], letters[1:3], paste0)
```

```
## [1] "Aa" "Bb" "Cc"
```

---
class: inverse-red middle
# safely

---
# Errors during iterations

Sometimes a loop will work for most cases, but return an error on a few


--
Often, you want to return the output you can


--
Alternatively, you might want to diagnose *where* the error is occurring


--
`purrr::safely()`


---
# Example

```r
by_cyl &lt;- mpg %&gt;% 
  group_by(cyl) %&gt;% 
  nest() 
by_cyl
```

```
## # A tibble: 4 Ã— 2
## # Groups:   cyl [4]
##     cyl data              
##   &lt;int&gt; &lt;list&gt;            
## 1     4 &lt;tibble [81 Ã— 10]&gt;
## 2     6 &lt;tibble [79 Ã— 10]&gt;
## 3     8 &lt;tibble [70 Ã— 10]&gt;
## 4     5 &lt;tibble [4 Ã— 10]&gt;
```

Please run the code above

<div class="countdown" id="timer_62311813" style="right:0;bottom:0;" data-warnwhen="0">
<code class="countdown-time"><span class="countdown-digits minutes">01</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Try to fit a model

(please follow along)

Notice the error message is *super* helpful! (this is new)


```r
by_cyl %&gt;% 
  mutate(mod = map(data, ~lm(hwy ~ displ + drv, data = .x)))
```

```
## Error in `mutate()`:
## ! Problem while computing `mod = map(data, ~lm(hwy ~ displ + drv, data = .x))`.
## â„¹ The error occurred in group 2: cyl = 5.
## Caused by error in `contrasts&lt;-`:
## ! contrasts can be applied only to factors with 2 or more levels
```

---
# Safe return

* First, define safe function - note that this will work for .ital[.b[any]] function

```r
safe_lm &lt;- safely(lm)
```


--

* Next, loop the safe function, instead of the standard function


--


```r
safe_models &lt;- by_cyl %&gt;% 
  mutate(safe_mod = map(data, ~safe_lm(hwy ~ displ + drv, data = .x)))
safe_models
```

```
## # A tibble: 4 Ã— 3
## # Groups:   cyl [4]
##     cyl data               safe_mod        
##   &lt;int&gt; &lt;list&gt;             &lt;list&gt;          
## 1     4 &lt;tibble [81 Ã— 10]&gt; &lt;named list [2]&gt;
## 2     6 &lt;tibble [79 Ã— 10]&gt; &lt;named list [2]&gt;
## 3     8 &lt;tibble [70 Ã— 10]&gt; &lt;named list [2]&gt;
## 4     5 &lt;tibble [4 Ã— 10]&gt;  &lt;named list [2]&gt;
```

---
# What's returned?


```r
safe_models$safe_mod[[1]]
```

```
## $result
## 
## Call:
## .f(formula = ..1, data = ..2)
## 
## Coefficients:
## (Intercept)        displ         drvf  
##      37.370       -5.289        3.882  
## 
## 
## $error
## NULL
```

```r
safe_models$safe_mod[[4]]
```

```
## $result
## NULL
## 
## $error
## &lt;simpleError in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels&gt;
```


---
# Inspecting
I often use `safely()` to help me de-bug. Why is it failing *there (but note the new error messages help with this too).


--
First - create a new variable to filter for results with errors

--

```r
safe_models %&gt;% 
  mutate(error = map_lgl(safe_mod, ~!is.null(.x$error)))
```

```
## # A tibble: 4 Ã— 4
## # Groups:   cyl [4]
##     cyl data               safe_mod         error
##   &lt;int&gt; &lt;list&gt;             &lt;list&gt;           &lt;lgl&gt;
## 1     4 &lt;tibble [81 Ã— 10]&gt; &lt;named list [2]&gt; FALSE
## 2     6 &lt;tibble [79 Ã— 10]&gt; &lt;named list [2]&gt; FALSE
## 3     8 &lt;tibble [70 Ã— 10]&gt; &lt;named list [2]&gt; FALSE
## 4     5 &lt;tibble [4 Ã— 10]&gt;  &lt;named list [2]&gt; TRUE
```

---
# Inspecting the data

```r
safe_models %&gt;% 
  mutate(error = map_lgl(safe_mod, ~!is.null(.x$error))) %&gt;% 
  filter(isTRUE(error)) %&gt;% 
  select(cyl, data) %&gt;% 
  unnest(data)
```

```
## # A tibble: 4 Ã— 11
## # Groups:   cyl [1]
##     cyl manufacturer model      displ  year trans      drv     cty   hwy fl    class     
##   &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     
## 1     5 volkswagen   jetta        2.5  2008 auto(s6)   f        21    29 r     compact   
## 2     5 volkswagen   jetta        2.5  2008 manual(m5) f        21    29 r     compact   
## 3     5 volkswagen   new beetle   2.5  2008 manual(m5) f        20    28 r     subcompact
## 4     5 volkswagen   new beetle   2.5  2008 auto(s6)   f        20    29 r     subcompact
```

The `displ` and `drv` variables are constant, so no relation can be estimated.


---
# Pull results that worked


```r
safe_models %&gt;% 
  mutate(results = map(safe_mod, "result"))
```

```
## # A tibble: 4 Ã— 4
## # Groups:   cyl [4]
##     cyl data               safe_mod         results
##   &lt;int&gt; &lt;list&gt;             &lt;list&gt;           &lt;list&gt; 
## 1     4 &lt;tibble [81 Ã— 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 2     6 &lt;tibble [79 Ã— 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 3     8 &lt;tibble [70 Ã— 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 4     5 &lt;tibble [4 Ã— 10]&gt;  &lt;named list [2]&gt; &lt;NULL&gt;
```

--
Now we can `broom::tidy()` or whatevs

---

Notice that there is no `cyl == 5`.


```r
safe_models %&gt;% 
  mutate(results = map(safe_mod, "result"),
         tidied = map(results, broom::tidy)) %&gt;% 
  select(cyl, tidied) %&gt;% 
  unnest(tidied)
```

```
## # A tibble: 11 Ã— 6
## # Groups:   cyl [3]
##      cyl term          estimate std.error  statistic      p.value
##    &lt;int&gt; &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
##  1     4 (Intercept) 37.37023   3.537572  10.56381   1.052943e-16
##  2     4 displ       -5.288562  1.436068  -3.682668  4.235795e- 4
##  3     4 drvf         3.882134  0.9971876  3.893083  2.073699e- 4
##  4     6 (Intercept) 27.96536   2.347630  11.91217   5.718039e-19
##  5     6 displ       -2.333261  0.6373304 -3.660991  4.651570e- 4
##  6     6 drvf         4.570840  0.6012367  7.602397  6.789988e-11
##  7     6 drvr         6.384355  1.229277   5.193585  1.713129e- 6
##  8     8 (Intercept) 14.82265   2.887289   5.133759  2.708515e- 6
##  9     8 displ        0.3060487 0.5719058  0.5351383 5.943528e- 1
## 10     8 drvf         8.555294  2.679129   3.193311  2.156229e- 3
## 11     8 drvr         3.709336  0.7319048  5.068058  3.473594e- 6
```

---
# When else might we use this?

--

Any sort of web scraping - pages change and URLs don't always work

---
# Example


```r
library(rvest)
links &lt;- list(
  "https://en.wikipedia.org/wiki/FC_Barcelona",
  "https://nosuchpage",
  "https://en.wikipedia.org/wiki/Rome"
)
pages &lt;- map(links, ~{
  Sys.sleep(0.1)
  read_html(.x)
})
```

```
## Error in open.connection(x, "rb"): Could not resolve host: nosuchpage
```

---
# The problem
I can't connect to https://nosuchpage because it doesn't exist


--
.center[.blue[.realbig[BUT]]]


--
That also means I can't get *any* of my links because *one* page errored (imagine it was 1 in 1,000 instead of 1 in 3)


--
## `safely()` to the rescue

---
# Safe version


```r
safe_read_html &lt;- safely(read_html)
pages &lt;- map(links, ~{
  Sys.sleep(0.1)
  safe_read_html(.x)
})
str(pages)
```

```
## List of 3
##  $ :List of 2
##   ..$ result:List of 2
##   .. ..$ node:&lt;externalptr&gt; 
##   .. ..$ doc :&lt;externalptr&gt; 
##   .. ..- attr(*, "class")= chr [1:2] "xml_document" "xml_node"
##   ..$ error : NULL
##  $ :List of 2
##   ..$ result: NULL
##   ..$ error :List of 2
##   .. ..$ message: chr "Could not resolve host: nosuchpage"
##   .. ..$ call   : language open.connection(x, "rb")
##   .. ..- attr(*, "class")= chr [1:3] "simpleError" "error" "condition"
##  $ :List of 2
##   ..$ result:List of 2
##   .. ..$ node:&lt;externalptr&gt; 
##   .. ..$ doc :&lt;externalptr&gt; 
##   .. ..- attr(*, "class")= chr [1:2] "xml_document" "xml_node"
##   ..$ error : NULL
```

---
# Non-results
In a real example, we'd probably want to double-check the pages where we got no results

--

```r
errors &lt;- map_lgl(pages, ~!is.null(.x$error))
links[errors]
```

```
## [[1]]
## [1] "https://nosuchpage"
```


---
class: inverse-red middle
# reduce

---
# Reducing a list
The `map()` family of functions will always return a vector the same length as the input


--
`reduce()` will collapse or reduce the list to a single element

---
# Example


```r
l &lt;- list(
  c(1, 3),
  c(1, 5, 7, 9),
  3,
  c(4, 8, 12, 2)
)

reduce(l, sum)
```

```
## [1] 55
```

---
# What's going on?
The code `reduce(l, sum)` is the same as


```r
sum(l[[4]], sum(l[[3]], sum(l[[1]], l[[2]])))
```

```
## [1] 55
```

Or slidghlty differently

```r
first_sum &lt;- sum(l[[1]], l[[2]])
second_sum &lt;- sum(first_sum, l[[3]])
final_sum &lt;- sum(second_sum, l[[4]])
final_sum
```

```
## [1] 55
```

---
# Why might you use this?
What if you had a list of data frames like this


```r
l_df &lt;- list(
  tibble(id = 1:3, score = rnorm(3)),
  tibble(id = 1:5, treatment = rbinom(5, 1, .5)),
  tibble(id = c(1, 3, 5, 7), other_thing = rnorm(4))
)
```

We can join these all together with a single loop - we want the output to be of length 1!

---

```r
reduce(l_df, full_join)
```

```
## # A tibble: 6 Ã— 4
##      id      score treatment other_thing
##   &lt;dbl&gt;      &lt;dbl&gt;     &lt;int&gt;       &lt;dbl&gt;
## 1     1  0.4766972         0  -1.639860 
## 2     2  0.1374334         1  NA        
## 3     3 -1.199778          1  -1.084139 
## 4     4 NA                 0  NA        
## 5     5 NA                 1   0.1617546
## 6     7 NA                NA  -1.353905
```

---
Note - you have to be careful on directionality



```r
reduce(l_df, left_join)
```

```
## # A tibble: 3 Ã— 4
##      id      score treatment other_thing
##   &lt;dbl&gt;      &lt;dbl&gt;     &lt;int&gt;       &lt;dbl&gt;
## 1     1  0.4766972         0   -1.639860
## 2     2  0.1374334         1   NA       
## 3     3 -1.199778          1   -1.084139
```

```r
reduce(l_df, right_join)
```

```
## # A tibble: 4 Ã— 4
##      id      score treatment other_thing
##   &lt;dbl&gt;      &lt;dbl&gt;     &lt;int&gt;       &lt;dbl&gt;
## 1     1  0.4766972         0  -1.639860 
## 2     3 -1.199778          1  -1.084139 
## 3     5 NA                 1   0.1617546
## 4     7 NA                NA  -1.353905
```

---
# Another example
You probably just want to `bind_rows()`


```r
l_df2 &lt;- list(
  tibble(id = 1:3, scid = 1, score = rnorm(3)),
  tibble(id = 1:5, scid = 2, score = rnorm(5)),
  tibble(id = c(1, 3, 5, 7), scid = 3, score = rnorm(4))
)
reduce(l_df2, bind_rows)
```

```
## # A tibble: 12 Ã— 3
##       id  scid      score
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     1     1  0.5484699
##  2     2     1 -0.9978538
##  3     3     1 -0.7118563
##  4     1     2  0.6336533
##  5     2     2 -0.1875615
##  6     3     2 -0.2686937
##  7     4     2  0.4248864
##  8     5     2  0.8668824
##  9     1     3 -0.1675307
## 10     3     3  1.418294 
## 11     5     3 -0.8494587
## 12     7     3 -1.575979
```

---
# Non-loop version

Luckily, the prior slide has become obsolete, because `bind_rows()` will do the list reduction for us.


```r
bind_rows(l_df2)
```

```
## # A tibble: 12 Ã— 3
##       id  scid      score
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     1     1  0.5484699
##  2     2     1 -0.9978538
##  3     3     1 -0.7118563
##  4     1     2  0.6336533
##  5     2     2 -0.1875615
##  6     3     2 -0.2686937
##  7     4     2  0.4248864
##  8     5     2  0.8668824
##  9     1     3 -0.1675307
## 10     3     3  1.418294 
## 11     5     3 -0.8494587
## 12     7     3 -1.575979
```


---
# Another example

This is a poor example, but there are use cases like this


```r
library(palmerpenguins)
map(penguins, as.character) %&gt;% 
  reduce(paste)
```

```
##   [1] "Adelie Torgersen 39.1 18.7 181 3750 male 2007"   "Adelie Torgersen 39.5 17.4 186 3800 female 2007"
##   [3] "Adelie Torgersen 40.3 18 195 3250 female 2007"   "Adelie Torgersen NA NA NA NA NA 2007"           
##   [5] "Adelie Torgersen 36.7 19.3 193 3450 female 2007" "Adelie Torgersen 39.3 20.6 190 3650 male 2007"  
##   [7] "Adelie Torgersen 38.9 17.8 181 3625 female 2007" "Adelie Torgersen 39.2 19.6 195 4675 male 2007"  
##   [9] "Adelie Torgersen 34.1 18.1 193 3475 NA 2007"     "Adelie Torgersen 42 20.2 190 4250 NA 2007"      
##  [11] "Adelie Torgersen 37.8 17.1 186 3300 NA 2007"     "Adelie Torgersen 37.8 17.3 180 3700 NA 2007"    
##  [13] "Adelie Torgersen 41.1 17.6 182 3200 female 2007" "Adelie Torgersen 38.6 21.2 191 3800 male 2007"  
##  [15] "Adelie Torgersen 34.6 21.1 198 4400 male 2007"   "Adelie Torgersen 36.6 17.8 185 3700 female 2007"
##  [17] "Adelie Torgersen 38.7 19 195 3450 female 2007"   "Adelie Torgersen 42.5 20.7 197 4500 male 2007"  
##  [19] "Adelie Torgersen 34.4 18.4 184 3325 female 2007" "Adelie Torgersen 46 21.5 194 4200 male 2007"    
##  [21] "Adelie Biscoe 37.8 18.3 174 3400 female 2007"    "Adelie Biscoe 37.7 18.7 180 3600 male 2007"     
##  [23] "Adelie Biscoe 35.9 19.2 189 3800 female 2007"    "Adelie Biscoe 38.2 18.1 185 3950 male 2007"     
##  [25] "Adelie Biscoe 38.8 17.2 180 3800 male 2007"      "Adelie Biscoe 35.3 18.9 187 3800 female 2007"   
##  [27] "Adelie Biscoe 40.6 18.6 183 3550 male 2007"      "Adelie Biscoe 40.5 17.9 187 3200 female 2007"   
##  [29] "Adelie Biscoe 37.9 18.6 172 3150 female 2007"    "Adelie Biscoe 40.5 18.9 180 3950 male 2007"     
##  [31] "Adelie Dream 39.5 16.7 178 3250 female 2007"     "Adelie Dream 37.2 18.1 178 3900 male 2007"      
##  [33] "Adelie Dream 39.5 17.8 188 3300 female 2007"     "Adelie Dream 40.9 18.9 184 3900 male 2007"      
##  [35] "Adelie Dream 36.4 17 195 3325 female 2007"       "Adelie Dream 39.2 21.1 196 4150 male 2007"      
##  [37] "Adelie Dream 38.8 20 190 3950 male 2007"         "Adelie Dream 42.2 18.5 180 3550 female 2007"    
##  [39] "Adelie Dream 37.6 19.3 181 3300 female 2007"     "Adelie Dream 39.8 19.1 184 4650 male 2007"      
##  [41] "Adelie Dream 36.5 18 182 3150 female 2007"       "Adelie Dream 40.8 18.4 195 3900 male 2007"      
##  [43] "Adelie Dream 36 18.5 186 3100 female 2007"       "Adelie Dream 44.1 19.7 196 4400 male 2007"      
##  [45] "Adelie Dream 37 16.9 185 3000 female 2007"       "Adelie Dream 39.6 18.8 190 4600 male 2007"      
##  [47] "Adelie Dream 41.1 19 182 3425 male 2007"         "Adelie Dream 37.5 18.9 179 2975 NA 2007"        
##  [49] "Adelie Dream 36 17.9 190 3450 female 2007"       "Adelie Dream 42.3 21.2 191 4150 male 2007"      
##  [51] "Adelie Biscoe 39.6 17.7 186 3500 female 2008"    "Adelie Biscoe 40.1 18.9 188 4300 male 2008"     
##  [53] "Adelie Biscoe 35 17.9 190 3450 female 2008"      "Adelie Biscoe 42 19.5 200 4050 male 2008"       
##  [55] "Adelie Biscoe 34.5 18.1 187 2900 female 2008"    "Adelie Biscoe 41.4 18.6 191 3700 male 2008"     
##  [57] "Adelie Biscoe 39 17.5 186 3550 female 2008"      "Adelie Biscoe 40.6 18.8 193 3800 male 2008"     
##  [59] "Adelie Biscoe 36.5 16.6 181 2850 female 2008"    "Adelie Biscoe 37.6 19.1 194 3750 male 2008"     
##  [61] "Adelie Biscoe 35.7 16.9 185 3150 female 2008"    "Adelie Biscoe 41.3 21.1 195 4400 male 2008"     
##  [63] "Adelie Biscoe 37.6 17 185 3600 female 2008"      "Adelie Biscoe 41.1 18.2 192 4050 male 2008"     
##  [65] "Adelie Biscoe 36.4 17.1 184 2850 female 2008"    "Adelie Biscoe 41.6 18 192 3950 male 2008"       
##  [67] "Adelie Biscoe 35.5 16.2 195 3350 female 2008"    "Adelie Biscoe 41.1 19.1 188 4100 male 2008"     
##  [69] "Adelie Torgersen 35.9 16.6 190 3050 female 2008" "Adelie Torgersen 41.8 19.4 198 4450 male 2008"  
##  [71] "Adelie Torgersen 33.5 19 190 3600 female 2008"   "Adelie Torgersen 39.7 18.4 190 3900 male 2008"  
##  [73] "Adelie Torgersen 39.6 17.2 196 3550 female 2008" "Adelie Torgersen 45.8 18.9 197 4150 male 2008"  
##  [75] "Adelie Torgersen 35.5 17.5 190 3700 female 2008" "Adelie Torgersen 42.8 18.5 195 4250 male 2008"  
##  [77] "Adelie Torgersen 40.9 16.8 191 3700 female 2008" "Adelie Torgersen 37.2 19.4 184 3900 male 2008"  
##  [79] "Adelie Torgersen 36.2 16.1 187 3550 female 2008" "Adelie Torgersen 42.1 19.1 195 4000 male 2008"  
##  [81] "Adelie Torgersen 34.6 17.2 189 3200 female 2008" "Adelie Torgersen 42.9 17.6 196 4700 male 2008"  
##  [83] "Adelie Torgersen 36.7 18.8 187 3800 female 2008" "Adelie Torgersen 35.1 19.4 193 4200 male 2008"  
##  [85] "Adelie Dream 37.3 17.8 191 3350 female 2008"     "Adelie Dream 41.3 20.3 194 3550 male 2008"      
##  [87] "Adelie Dream 36.3 19.5 190 3800 male 2008"       "Adelie Dream 36.9 18.6 189 3500 female 2008"    
##  [89] "Adelie Dream 38.3 19.2 189 3950 male 2008"       "Adelie Dream 38.9 18.8 190 3600 female 2008"    
##  [91] "Adelie Dream 35.7 18 202 3550 female 2008"       "Adelie Dream 41.1 18.1 205 4300 male 2008"      
##  [93] "Adelie Dream 34 17.1 185 3400 female 2008"       "Adelie Dream 39.6 18.1 186 4450 male 2008"      
##  [95] "Adelie Dream 36.2 17.3 187 3300 female 2008"     "Adelie Dream 40.8 18.9 208 4300 male 2008"      
##  [97] "Adelie Dream 38.1 18.6 190 3700 female 2008"     "Adelie Dream 40.3 18.5 196 4350 male 2008"      
##  [99] "Adelie Dream 33.1 16.1 178 2900 female 2008"     "Adelie Dream 43.2 18.5 192 4100 male 2008"      
## [101] "Adelie Biscoe 35 17.9 192 3725 female 2009"      "Adelie Biscoe 41 20 203 4725 male 2009"         
## [103] "Adelie Biscoe 37.7 16 183 3075 female 2009"      "Adelie Biscoe 37.8 20 190 4250 male 2009"       
## [105] "Adelie Biscoe 37.9 18.6 193 2925 female 2009"    "Adelie Biscoe 39.7 18.9 184 3550 male 2009"     
## [107] "Adelie Biscoe 38.6 17.2 199 3750 female 2009"    "Adelie Biscoe 38.2 20 190 3900 male 2009"       
## [109] "Adelie Biscoe 38.1 17 181 3175 female 2009"      "Adelie Biscoe 43.2 19 197 4775 male 2009"       
## [111] "Adelie Biscoe 38.1 16.5 198 3825 female 2009"    "Adelie Biscoe 45.6 20.3 191 4600 male 2009"     
## [113] "Adelie Biscoe 39.7 17.7 193 3200 female 2009"    "Adelie Biscoe 42.2 19.5 197 4275 male 2009"     
## [115] "Adelie Biscoe 39.6 20.7 191 3900 female 2009"    "Adelie Biscoe 42.7 18.3 196 4075 male 2009"     
## [117] "Adelie Torgersen 38.6 17 188 2900 female 2009"   "Adelie Torgersen 37.3 20.5 199 3775 male 2009"  
## [119] "Adelie Torgersen 35.7 17 189 3350 female 2009"   "Adelie Torgersen 41.1 18.6 189 3325 male 2009"  
## [121] "Adelie Torgersen 36.2 17.2 187 3150 female 2009" "Adelie Torgersen 37.7 19.8 198 3500 male 2009"  
## [123] "Adelie Torgersen 40.2 17 176 3450 female 2009"   "Adelie Torgersen 41.4 18.5 202 3875 male 2009"  
## [125] "Adelie Torgersen 35.2 15.9 186 3050 female 2009" "Adelie Torgersen 40.6 19 199 4000 male 2009"    
## [127] "Adelie Torgersen 38.8 17.6 191 3275 female 2009" "Adelie Torgersen 41.5 18.3 195 4300 male 2009"  
## [129] "Adelie Torgersen 39 17.1 191 3050 female 2009"   "Adelie Torgersen 44.1 18 210 4000 male 2009"    
## [131] "Adelie Torgersen 38.5 17.9 190 3325 female 2009" "Adelie Torgersen 43.1 19.2 197 3500 male 2009"  
## [133] "Adelie Dream 36.8 18.5 193 3500 female 2009"     "Adelie Dream 37.5 18.5 199 4475 male 2009"      
## [135] "Adelie Dream 38.1 17.6 187 3425 female 2009"     "Adelie Dream 41.1 17.5 190 3900 male 2009"      
## [137] "Adelie Dream 35.6 17.5 191 3175 female 2009"     "Adelie Dream 40.2 20.1 200 3975 male 2009"      
## [139] "Adelie Dream 37 16.5 185 3400 female 2009"       "Adelie Dream 39.7 17.9 193 4250 male 2009"      
## [141] "Adelie Dream 40.2 17.1 193 3400 female 2009"     "Adelie Dream 40.6 17.2 187 3475 male 2009"      
## [143] "Adelie Dream 32.1 15.5 188 3050 female 2009"     "Adelie Dream 40.7 17 190 3725 male 2009"        
## [145] "Adelie Dream 37.3 16.8 192 3000 female 2009"     "Adelie Dream 39 18.7 185 3650 male 2009"        
## [147] "Adelie Dream 39.2 18.6 190 4250 male 2009"       "Adelie Dream 36.6 18.4 184 3475 female 2009"    
## [149] "Adelie Dream 36 17.8 195 3450 female 2009"       "Adelie Dream 37.8 18.1 193 3750 male 2009"      
## [151] "Adelie Dream 36 17.1 187 3700 female 2009"       "Adelie Dream 41.5 18.5 201 4000 male 2009"      
## [153] "Gentoo Biscoe 46.1 13.2 211 4500 female 2007"    "Gentoo Biscoe 50 16.3 230 5700 male 2007"       
## [155] "Gentoo Biscoe 48.7 14.1 210 4450 female 2007"    "Gentoo Biscoe 50 15.2 218 5700 male 2007"       
## [157] "Gentoo Biscoe 47.6 14.5 215 5400 male 2007"      "Gentoo Biscoe 46.5 13.5 210 4550 female 2007"   
## [159] "Gentoo Biscoe 45.4 14.6 211 4800 female 2007"    "Gentoo Biscoe 46.7 15.3 219 5200 male 2007"     
## [161] "Gentoo Biscoe 43.3 13.4 209 4400 female 2007"    "Gentoo Biscoe 46.8 15.4 215 5150 male 2007"     
## [163] "Gentoo Biscoe 40.9 13.7 214 4650 female 2007"    "Gentoo Biscoe 49 16.1 216 5550 male 2007"       
## [165] "Gentoo Biscoe 45.5 13.7 214 4650 female 2007"    "Gentoo Biscoe 48.4 14.6 213 5850 male 2007"     
## [167] "Gentoo Biscoe 45.8 14.6 210 4200 female 2007"    "Gentoo Biscoe 49.3 15.7 217 5850 male 2007"     
## [169] "Gentoo Biscoe 42 13.5 210 4150 female 2007"      "Gentoo Biscoe 49.2 15.2 221 6300 male 2007"     
## [171] "Gentoo Biscoe 46.2 14.5 209 4800 female 2007"    "Gentoo Biscoe 48.7 15.1 222 5350 male 2007"     
## [173] "Gentoo Biscoe 50.2 14.3 218 5700 male 2007"      "Gentoo Biscoe 45.1 14.5 215 5000 female 2007"   
## [175] "Gentoo Biscoe 46.5 14.5 213 4400 female 2007"    "Gentoo Biscoe 46.3 15.8 215 5050 male 2007"     
## [177] "Gentoo Biscoe 42.9 13.1 215 5000 female 2007"    "Gentoo Biscoe 46.1 15.1 215 5100 male 2007"     
## [179] "Gentoo Biscoe 44.5 14.3 216 4100 NA 2007"        "Gentoo Biscoe 47.8 15 215 5650 male 2007"       
## [181] "Gentoo Biscoe 48.2 14.3 210 4600 female 2007"    "Gentoo Biscoe 50 15.3 220 5550 male 2007"       
## [183] "Gentoo Biscoe 47.3 15.3 222 5250 male 2007"      "Gentoo Biscoe 42.8 14.2 209 4700 female 2007"   
## [185] "Gentoo Biscoe 45.1 14.5 207 5050 female 2007"    "Gentoo Biscoe 59.6 17 230 6050 male 2007"       
## [187] "Gentoo Biscoe 49.1 14.8 220 5150 female 2008"    "Gentoo Biscoe 48.4 16.3 220 5400 male 2008"     
## [189] "Gentoo Biscoe 42.6 13.7 213 4950 female 2008"    "Gentoo Biscoe 44.4 17.3 219 5250 male 2008"     
## [191] "Gentoo Biscoe 44 13.6 208 4350 female 2008"      "Gentoo Biscoe 48.7 15.7 208 5350 male 2008"     
## [193] "Gentoo Biscoe 42.7 13.7 208 3950 female 2008"    "Gentoo Biscoe 49.6 16 225 5700 male 2008"       
## [195] "Gentoo Biscoe 45.3 13.7 210 4300 female 2008"    "Gentoo Biscoe 49.6 15 216 4750 male 2008"       
## [197] "Gentoo Biscoe 50.5 15.9 222 5550 male 2008"      "Gentoo Biscoe 43.6 13.9 217 4900 female 2008"   
## [199] "Gentoo Biscoe 45.5 13.9 210 4200 female 2008"    "Gentoo Biscoe 50.5 15.9 225 5400 male 2008"     
## [201] "Gentoo Biscoe 44.9 13.3 213 5100 female 2008"    "Gentoo Biscoe 45.2 15.8 215 5300 male 2008"     
## [203] "Gentoo Biscoe 46.6 14.2 210 4850 female 2008"    "Gentoo Biscoe 48.5 14.1 220 5300 male 2008"     
## [205] "Gentoo Biscoe 45.1 14.4 210 4400 female 2008"    "Gentoo Biscoe 50.1 15 225 5000 male 2008"       
## [207] "Gentoo Biscoe 46.5 14.4 217 4900 female 2008"    "Gentoo Biscoe 45 15.4 220 5050 male 2008"       
## [209] "Gentoo Biscoe 43.8 13.9 208 4300 female 2008"    "Gentoo Biscoe 45.5 15 220 5000 male 2008"       
## [211] "Gentoo Biscoe 43.2 14.5 208 4450 female 2008"    "Gentoo Biscoe 50.4 15.3 224 5550 male 2008"     
## [213] "Gentoo Biscoe 45.3 13.8 208 4200 female 2008"    "Gentoo Biscoe 46.2 14.9 221 5300 male 2008"     
## [215] "Gentoo Biscoe 45.7 13.9 214 4400 female 2008"    "Gentoo Biscoe 54.3 15.7 231 5650 male 2008"     
## [217] "Gentoo Biscoe 45.8 14.2 219 4700 female 2008"    "Gentoo Biscoe 49.8 16.8 230 5700 male 2008"     
## [219] "Gentoo Biscoe 46.2 14.4 214 4650 NA 2008"        "Gentoo Biscoe 49.5 16.2 229 5800 male 2008"     
## [221] "Gentoo Biscoe 43.5 14.2 220 4700 female 2008"    "Gentoo Biscoe 50.7 15 223 5550 male 2008"       
## [223] "Gentoo Biscoe 47.7 15 216 4750 female 2008"      "Gentoo Biscoe 46.4 15.6 221 5000 male 2008"     
## [225] "Gentoo Biscoe 48.2 15.6 221 5100 male 2008"      "Gentoo Biscoe 46.5 14.8 217 5200 female 2008"   
## [227] "Gentoo Biscoe 46.4 15 216 4700 female 2008"      "Gentoo Biscoe 48.6 16 230 5800 male 2008"       
## [229] "Gentoo Biscoe 47.5 14.2 209 4600 female 2008"    "Gentoo Biscoe 51.1 16.3 220 6000 male 2008"     
## [231] "Gentoo Biscoe 45.2 13.8 215 4750 female 2008"    "Gentoo Biscoe 45.2 16.4 223 5950 male 2008"     
## [233] "Gentoo Biscoe 49.1 14.5 212 4625 female 2009"    "Gentoo Biscoe 52.5 15.6 221 5450 male 2009"     
## [235] "Gentoo Biscoe 47.4 14.6 212 4725 female 2009"    "Gentoo Biscoe 50 15.9 224 5350 male 2009"       
## [237] "Gentoo Biscoe 44.9 13.8 212 4750 female 2009"    "Gentoo Biscoe 50.8 17.3 228 5600 male 2009"     
## [239] "Gentoo Biscoe 43.4 14.4 218 4600 female 2009"    "Gentoo Biscoe 51.3 14.2 218 5300 male 2009"     
## [241] "Gentoo Biscoe 47.5 14 212 4875 female 2009"      "Gentoo Biscoe 52.1 17 230 5550 male 2009"       
## [243] "Gentoo Biscoe 47.5 15 218 4950 female 2009"      "Gentoo Biscoe 52.2 17.1 228 5400 male 2009"     
## [245] "Gentoo Biscoe 45.5 14.5 212 4750 female 2009"    "Gentoo Biscoe 49.5 16.1 224 5650 male 2009"     
## [247] "Gentoo Biscoe 44.5 14.7 214 4850 female 2009"    "Gentoo Biscoe 50.8 15.7 226 5200 male 2009"     
## [249] "Gentoo Biscoe 49.4 15.8 216 4925 male 2009"      "Gentoo Biscoe 46.9 14.6 222 4875 female 2009"   
## [251] "Gentoo Biscoe 48.4 14.4 203 4625 female 2009"    "Gentoo Biscoe 51.1 16.5 225 5250 male 2009"     
## [253] "Gentoo Biscoe 48.5 15 219 4850 female 2009"      "Gentoo Biscoe 55.9 17 228 5600 male 2009"       
## [255] "Gentoo Biscoe 47.2 15.5 215 4975 female 2009"    "Gentoo Biscoe 49.1 15 228 5500 male 2009"       
## [257] "Gentoo Biscoe 47.3 13.8 216 4725 NA 2009"        "Gentoo Biscoe 46.8 16.1 215 5500 male 2009"     
## [259] "Gentoo Biscoe 41.7 14.7 210 4700 female 2009"    "Gentoo Biscoe 53.4 15.8 219 5500 male 2009"     
## [261] "Gentoo Biscoe 43.3 14 208 4575 female 2009"      "Gentoo Biscoe 48.1 15.1 209 5500 male 2009"     
## [263] "Gentoo Biscoe 50.5 15.2 216 5000 female 2009"    "Gentoo Biscoe 49.8 15.9 229 5950 male 2009"     
## [265] "Gentoo Biscoe 43.5 15.2 213 4650 female 2009"    "Gentoo Biscoe 51.5 16.3 230 5500 male 2009"     
## [267] "Gentoo Biscoe 46.2 14.1 217 4375 female 2009"    "Gentoo Biscoe 55.1 16 230 5850 male 2009"       
## [269] "Gentoo Biscoe 44.5 15.7 217 4875 NA 2009"        "Gentoo Biscoe 48.8 16.2 222 6000 male 2009"     
## [271] "Gentoo Biscoe 47.2 13.7 214 4925 female 2009"    "Gentoo Biscoe NA NA NA NA NA 2009"              
## [273] "Gentoo Biscoe 46.8 14.3 215 4850 female 2009"    "Gentoo Biscoe 50.4 15.7 222 5750 male 2009"     
## [275] "Gentoo Biscoe 45.2 14.8 212 5200 female 2009"    "Gentoo Biscoe 49.9 16.1 213 5400 male 2009"     
## [277] "Chinstrap Dream 46.5 17.9 192 3500 female 2007"  "Chinstrap Dream 50 19.5 196 3900 male 2007"     
## [279] "Chinstrap Dream 51.3 19.2 193 3650 male 2007"    "Chinstrap Dream 45.4 18.7 188 3525 female 2007" 
## [281] "Chinstrap Dream 52.7 19.8 197 3725 male 2007"    "Chinstrap Dream 45.2 17.8 198 3950 female 2007" 
## [283] "Chinstrap Dream 46.1 18.2 178 3250 female 2007"  "Chinstrap Dream 51.3 18.2 197 3750 male 2007"   
## [285] "Chinstrap Dream 46 18.9 195 4150 female 2007"    "Chinstrap Dream 51.3 19.9 198 3700 male 2007"   
## [287] "Chinstrap Dream 46.6 17.8 193 3800 female 2007"  "Chinstrap Dream 51.7 20.3 194 3775 male 2007"   
## [289] "Chinstrap Dream 47 17.3 185 3700 female 2007"    "Chinstrap Dream 52 18.1 201 4050 male 2007"     
## [291] "Chinstrap Dream 45.9 17.1 190 3575 female 2007"  "Chinstrap Dream 50.5 19.6 201 4050 male 2007"   
## [293] "Chinstrap Dream 50.3 20 197 3300 male 2007"      "Chinstrap Dream 58 17.8 181 3700 female 2007"   
## [295] "Chinstrap Dream 46.4 18.6 190 3450 female 2007"  "Chinstrap Dream 49.2 18.2 195 4400 male 2007"   
## [297] "Chinstrap Dream 42.4 17.3 181 3600 female 2007"  "Chinstrap Dream 48.5 17.5 191 3400 male 2007"   
## [299] "Chinstrap Dream 43.2 16.6 187 2900 female 2007"  "Chinstrap Dream 50.6 19.4 193 3800 male 2007"   
## [301] "Chinstrap Dream 46.7 17.9 195 3300 female 2007"  "Chinstrap Dream 52 19 197 4150 male 2007"       
## [303] "Chinstrap Dream 50.5 18.4 200 3400 female 2008"  "Chinstrap Dream 49.5 19 200 3800 male 2008"     
## [305] "Chinstrap Dream 46.4 17.8 191 3700 female 2008"  "Chinstrap Dream 52.8 20 205 4550 male 2008"     
## [307] "Chinstrap Dream 40.9 16.6 187 3200 female 2008"  "Chinstrap Dream 54.2 20.8 201 4300 male 2008"   
## [309] "Chinstrap Dream 42.5 16.7 187 3350 female 2008"  "Chinstrap Dream 51 18.8 203 4100 male 2008"     
## [311] "Chinstrap Dream 49.7 18.6 195 3600 male 2008"    "Chinstrap Dream 47.5 16.8 199 3900 female 2008" 
## [313] "Chinstrap Dream 47.6 18.3 195 3850 female 2008"  "Chinstrap Dream 52 20.7 210 4800 male 2008"     
## [315] "Chinstrap Dream 46.9 16.6 192 2700 female 2008"  "Chinstrap Dream 53.5 19.9 205 4500 male 2008"   
## [317] "Chinstrap Dream 49 19.5 210 3950 male 2008"      "Chinstrap Dream 46.2 17.5 187 3650 female 2008" 
## [319] "Chinstrap Dream 50.9 19.1 196 3550 male 2008"    "Chinstrap Dream 45.5 17 196 3500 female 2008"   
## [321] "Chinstrap Dream 50.9 17.9 196 3675 female 2009"  "Chinstrap Dream 50.8 18.5 201 4450 male 2009"   
## [323] "Chinstrap Dream 50.1 17.9 190 3400 female 2009"  "Chinstrap Dream 49 19.6 212 4300 male 2009"     
## [325] "Chinstrap Dream 51.5 18.7 187 3250 male 2009"    "Chinstrap Dream 49.8 17.3 198 3675 female 2009" 
## [327] "Chinstrap Dream 48.1 16.4 199 3325 female 2009"  "Chinstrap Dream 51.4 19 201 3950 male 2009"     
## [329] "Chinstrap Dream 45.7 17.3 193 3600 female 2009"  "Chinstrap Dream 50.7 19.7 203 4050 male 2009"   
## [331] "Chinstrap Dream 42.5 17.3 187 3350 female 2009"  "Chinstrap Dream 52.2 18.8 197 3450 male 2009"   
## [333] "Chinstrap Dream 45.2 16.6 191 3250 female 2009"  "Chinstrap Dream 49.3 19.9 203 4050 male 2009"   
## [335] "Chinstrap Dream 50.2 18.8 202 3800 male 2009"    "Chinstrap Dream 45.6 19.4 194 3525 female 2009" 
## [337] "Chinstrap Dream 51.9 19.5 206 3950 male 2009"    "Chinstrap Dream 46.8 16.5 189 3650 female 2009" 
## [339] "Chinstrap Dream 45.7 17 195 3650 female 2009"    "Chinstrap Dream 55.8 19.8 207 4000 male 2009"   
## [341] "Chinstrap Dream 43.5 18.1 202 3400 female 2009"  "Chinstrap Dream 49.6 18.2 193 3775 male 2009"   
## [343] "Chinstrap Dream 50.8 19 210 4100 male 2009"      "Chinstrap Dream 50.2 18.7 198 3775 female 2009"
```


---
# Why use `reduce()`

This is one that I use a fair bit, but have a hard time coming up with good examples for.

The tidyverse makes it less needed, generally.

Still a good "tool" to have

---
# Wrap up
* Lots more to `{purrr}` but we've covered a lot
  
* Functional programming can *really* help your efficiency, and even if it slows you down initially, I'd recommend always striving toward it, because it will ultimately be a huge help.


.center[

### Questions?

]

--
If we have any time left - let's work on the homework

---
class: inverse-green middle
# Next time
## Functions
Beginning next class, the focus of the course will shift
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"navigation": {
"scroll": false
},
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
